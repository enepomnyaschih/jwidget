Ext.data.JsonP.ensample5({"guide":"<h1 id='ensample5-section-part-5.-collection-synchronizers'>Part 5. Collection synchronizers</h1>\n\n<p>Demo: <a href=\"http://enepomnyaschih.github.io/mt/5/\">http://enepomnyaschih.github.io/mt/5/</a></p>\n\n<p>Source: <a href=\"https://github.com/enepomnyaschih/mt/tree/mt-5\">https://github.com/enepomnyaschih/mt/tree/mt-5</a> (Git plugin)</p>\n\n<p>Now we'll switch to the most wonderful and important part of jWidget which makes jWidget special -\ncollection synchronizers.</p>\n\n<p>In this example, we'll add a feature of new tweets posting and existing tweets removal.</p>\n\n<p>Let's start with a bit of refactoring. We have a next code snippet in mt.TweetFeed class:</p>\n\n<pre><code>    renderTweets: function() {\n        this.tweetViews = this.data.tweets.<a href=\"#!/api/JW.AbstractArray-method-S-map\" rel=\"JW.AbstractArray-method-S-map\" class=\"docClass\">$map</a>(function(tweetData) {\n            return new mt.TweetView(tweetData);\n        }, this);\n        return this.tweetViews;\n    },\n</code></pre>\n\n<p>Just to remind, this code converts data array of mt.data.Tweet instances to view array of mt.TweetView instances,\nand renders them into element with jwid=\"tweets\".</p>\n\n<p>You must understand that this code won't let us to install continuous synchronization of view array with data array:\ndata convertion is performed only once, at the moment of tweet feed rendering. Sure, you may bind listeners\nto data array modification events manually (that's what you've got to do in other frameworks), but jWidget\noffers much easier solution - use synchronizer for this.</p>\n\n<p>Moreover, jWidget philosophy claims that\n<strong>there should be no difference between simple and observable collection manipulations. Although it is enough to\ncall some algorithm to convert one simple collection to another (here: <a href=\"#!/api/JW.AbstractArray-method-S-map\" rel=\"JW.AbstractArray-method-S-map\" class=\"docClass\">$map</a>),\nit is recommended to instantiate a synchronizer instead.</strong></p>\n\n<p>So, let's replace code of mt.TweetFeed with the next:</p>\n\n<p><strong>public/mt/tweetfeed/tweetfeed.js</strong></p>\n\n<pre><code>mt.TweetFeed = function(data) {\n    mt.TweetFeed.<a href=\"#!/api/JW.Class-static-property-_super\" rel=\"JW.Class-static-property-_super\" class=\"docClass\">_super</a>.call(this);\n    this.data = data;\n    this._mapper = null;\n};\n\n<a href=\"#!/api/JW-static-method-extend\" rel=\"JW-static-method-extend\" class=\"docClass\">JW.extend</a>(mt.TweetFeed, <a href=\"#!/api/JW.UI.Component\" rel=\"JW.UI.Component\" class=\"docClass\">JW.UI.Component</a>, {\n    /*\n    mt.Data data;\n    <a href=\"#!/api/JW.AbstractArray.Mapper\" rel=\"JW.AbstractArray.Mapper\" class=\"docClass\">JW.AbstractArray.Mapper</a>&lt;mt.data.Tweet, mt.TweetView&gt; _mapper;\n    */\n\n    renderTweets: function() {\n        this._mapper = this.data.tweets.<a href=\"#!/api/JW.AbstractArray-method-createMapper\" rel=\"JW.AbstractArray-method-createMapper\" class=\"docClass\">createMapper</a>({\n            <a href=\"#!/api/JW.AbstractCollection.Mapper-cfg-createItem\" rel=\"JW.AbstractCollection.Mapper-cfg-createItem\" class=\"docClass\">createItem</a>: function(tweetData) {\n                return new mt.TweetView(tweetData);\n            },\n            <a href=\"#!/api/JW.AbstractCollection.Mapper-cfg-destroyItem\" rel=\"JW.AbstractCollection.Mapper-cfg-destroyItem\" class=\"docClass\">destroyItem</a>: <a href=\"#!/api/JW-static-method-destroy\" rel=\"JW-static-method-destroy\" class=\"docClass\">JW.destroy</a>,\n            <a href=\"#!/api/JW.AbstractCollection.Mapper-cfg-scope\" rel=\"JW.AbstractCollection.Mapper-cfg-scope\" class=\"docClass\">scope</a>: this\n        });\n        return this._mapper.<a href=\"#!/api/JW.AbstractArray.Mapper-property-target\" rel=\"JW.AbstractArray.Mapper-property-target\" class=\"docClass\">target</a>;\n    },\n\n    // override\n    <a href=\"#!/api/JW.UI.Component-method-destroyComponent\" rel=\"JW.UI.Component-method-destroyComponent\" class=\"docClass\">destroyComponent</a>: function() {\n        this._mapper.<a href=\"#!/api/JW.Class-method-destroy\" rel=\"JW.Class-method-destroy\" class=\"docClass\">destroy</a>();\n        this.<a href=\"#!/api/JW.Class-method-_super\" rel=\"JW.Class-method-_super\" class=\"docClass\">_super</a>();\n    }\n});\n</code></pre>\n\n<p>Since our array of this.data.tweets is still simple (<a href=\"#!/api/JW.Array\" rel=\"JW.Array\" class=\"docClass\">JW.Array</a>), this code is completely equal to original one -\nrun the application in browser and you won't see any difference. But now we are able to replace simple array\nin mt.Data with <a href=\"#!/api/JW.ObservableArray\" rel=\"JW.ObservableArray\" class=\"docClass\">JW.ObservableArray</a>, and synchronize view with model without view modification this way:</p>\n\n<pre><code>mt.Data = function() {\n    mt.Data.<a href=\"#!/api/JW.Class-static-property-_super\" rel=\"JW.Class-static-property-_super\" class=\"docClass\">_super</a>.call(this);\n    this.profile = null;\n    this.tweets = new <a href=\"#!/api/JW.ObservableArray\" rel=\"JW.ObservableArray\" class=\"docClass\">JW.ObservableArray</a>();\n};\n</code></pre>\n\n<p>Try to open application in browser and run next command in console:</p>\n\n<pre><code>data.tweets.<a href=\"#!/api/JW.AbstractArray-method-add\" rel=\"JW.AbstractArray-method-add\" class=\"docClass\">add</a>(new mt.data.Tweet({\n    fullName: \"Road Runner\",\n    shortName: \"roadrunner\",\n    avatarUrl48: \"backend/avatar-48.png\",\n    contentHtml: \"This is a new tweet!\",\n    time: new Date().getTime(),\n    like: false,\n    retweet: false\n}));\n</code></pre>\n\n<p>You'll see that a new tweet will appear at the end of tweet feed:</p>\n\n<p><p><img src=\"guides/ensample5/result-1.png\" alt=\"\" width=\"944\" height=\"575\"></p></p>\n\n<p>Notice that we didn't touch view by this command: we've just added an object into data array, but view has\nupdated correctly.</p>\n\n<p>The only remaining part is to add code which will add a new object into data.tweets array on \"Compose tweet\" form\nsubmit. Bind to jQuery.submit event in mt.ProfileBox:</p>\n\n<pre><code>mt.ProfileBox = function(data) {\n    this._onComposeSubmit = <a href=\"#!/api/JW-static-method-inScope\" rel=\"JW-static-method-inScope\" class=\"docClass\">JW.inScope</a>(this._onComposeSubmit, this);\n    mt.ProfileBox.<a href=\"#!/api/JW.Class-static-property-_super\" rel=\"JW.Class-static-property-_super\" class=\"docClass\">_super</a>.call(this);\n    this.data = data;\n};\n\n<a href=\"#!/api/JW-static-method-extend\" rel=\"JW-static-method-extend\" class=\"docClass\">JW.extend</a>(mt.ProfileBox, <a href=\"#!/api/JW.UI.Component\" rel=\"JW.UI.Component\" class=\"docClass\">JW.UI.Component</a>, {\n    // ... code\n\n    renderComposeForm: function(el) {\n        el.submit(this._onComposeSubmit);\n    },\n\n    _onComposeSubmit: function(event) {\n        event.preventDefault();\n        var text = <a href=\"#!/api/JW.String-static-method-trim\" rel=\"JW.String-static-method-trim\" class=\"docClass\">JW.String.trim</a>(this.<a href=\"#!/api/JW.UI.Component-method-getElement\" rel=\"JW.UI.Component-method-getElement\" class=\"docClass\">getElement</a>(\"compose-input\").val());\n        if (!text) {\n            return;\n        }\n        this.data.tweets.<a href=\"#!/api/JW.AbstractArray-method-add\" rel=\"JW.AbstractArray-method-add\" class=\"docClass\">add</a>(new mt.data.Tweet({\n            fullName: this.data.profile.fullName,\n            shortName: this.data.profile.shortName,\n            avatarUrl48: this.data.profile.avatarUrl48,\n            contentHtml: text,\n            time: new Date().getTime(),\n            like: false,\n            retweet: false\n        }), 0);\n        this.<a href=\"#!/api/JW.UI.Component-method-getElement\" rel=\"JW.UI.Component-method-getElement\" class=\"docClass\">getElement</a>(\"compose-input\").val(\"\")\n    }\n});\n</code></pre>\n\n<p>And run our application. After text input and \"Tweet\" button click, we'll see a new tweet in tweet feed:</p>\n\n<p><p><img src=\"guides/ensample5/result-2.png\" alt=\"\" width=\"942\" height=\"298\"></p></p>\n\n<p><p><img src=\"guides/ensample5/result-3.png\" alt=\"\" width=\"942\" height=\"375\"></p></p>\n\n<p>Our next goal is to activate Remove button in tweets to remove them from feed. Open mt.TweetView class and bind\nto button click:</p>\n\n<pre><code>mt.TweetView = function(tweetData) {\n    // ...\n    this._onRemoveClick = <a href=\"#!/api/JW-static-method-inScope\" rel=\"JW-static-method-inScope\" class=\"docClass\">JW.inScope</a>(this._onRemoveClick, this);\n    mt.TweetView.<a href=\"#!/api/JW.Class-static-property-_super\" rel=\"JW.Class-static-property-_super\" class=\"docClass\">_super</a>.call(this);\n    // ...\n};\n\n<a href=\"#!/api/JW-static-method-extend\" rel=\"JW-static-method-extend\" class=\"docClass\">JW.extend</a>(mt.TweetView, <a href=\"#!/api/JW.UI.Component\" rel=\"JW.UI.Component\" class=\"docClass\">JW.UI.Component</a>, {\n    // ...\n\n    renderRemove: function(el) {\n        el.click(this._onRemoveClick);\n    },\n\n    // ...\n\n    _onRemoveClick: function(event) {\n        event.preventDefault();\n    },\n\n    // ...\n});\n</code></pre>\n\n<p>We'll need access to mt.Data object to remove the tweet. Let's provide it:</p>\n\n<pre><code>mt.TweetView = function(data, tweetData) {\n    // ...\n    mt.TweetView.<a href=\"#!/api/JW.Class-static-property-_super\" rel=\"JW.Class-static-property-_super\" class=\"docClass\">_super</a>.call(this);\n    this.data = data;\n    this.tweetData = tweetData;\n};\n\n<a href=\"#!/api/JW-static-method-extend\" rel=\"JW-static-method-extend\" class=\"docClass\">JW.extend</a>(mt.TweetView, <a href=\"#!/api/JW.UI.Component\" rel=\"JW.UI.Component\" class=\"docClass\">JW.UI.Component</a>, {\n    /*\n    mt.Data data;\n    ...\n    */\n\n    // ...\n});\n</code></pre>\n\n<p>Update code for mt.TweetView object creation in mt.TweetFeed:</p>\n\n<pre><code>            createItem: function(tweetData) {\n                return new mt.TweetView(this.data, tweetData);\n            },\n</code></pre>\n\n<p>And finish _onRemoveClick method implementation in mt.TweetView class:</p>\n\n<pre><code>    _onRemoveClick: function(event) {\n        event.preventDefault();\n        this.data.tweets.<a href=\"#!/api/JW.AbstractArray-method-removeItem\" rel=\"JW.AbstractArray-method-removeItem\" class=\"docClass\">removeItem</a>(this.tweetData);\n    },\n</code></pre>\n\n<p>Run application and try to click Remove button in tweet:</p>\n\n<p><p><img src=\"guides/ensample5/result-4.png\" alt=\"\" width=\"950\" height=\"266\"></p></p>\n\n<p>In this example we've reviewed a typical scenario of array item converter (<a href=\"#!/api/JW.AbstractCollection.Mapper\" rel=\"JW.AbstractCollection.Mapper\" class=\"docClass\">JW.AbstractCollection.Mapper</a>) usage,\nbut don't stop at this. You should try other synchronizers by your own, and I'm sure you'll find reasonable\nuse cases for majority of them. Find them in <a href=\"#!/api/JW.AbstractCollection\" rel=\"JW.AbstractCollection\" class=\"docClass\">JW.AbstractCollection</a> class description.</p>\n\n<p>Notice that synchronizers usage is not constrained by view only. In my practice, synchronizers are used in model\nmore often than in view. For example, indexer will speed-up access to the items by key. Sorter can sort a set of\ntweets by their publication date, and you won't need to think at what position to insert a new tweet in tweet feed.\nThere is a lot of scenarios, and I recommend you to try them in practice.</p>\n\n<p>In next part, we'll improve infrastructure of our project: extract HTML templates into separate HTML files using\n<a href=\"https://github.com/enepomnyaschih/jwsdk/wiki/ru\">jWidget SDK</a> and will learn how to use CSS-preprocessor\n<a href=\"http://learnboost.github.io/stylus/\">Stylus</a> to make slicing easier and more convenient.</p>\n","title":"Part 5. Collection synchronizers"});