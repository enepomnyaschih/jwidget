JW.Tests={};JW.Tests.Plugins={};JW.Tests.Plugins.LocaleTestCase=JW.Unit.TestCase.extend({setup:function(){this.dictionary={en:{_lang:"English",name:"Name",submit:"Submit",equipment:{monitor:"Monitor",keyboard:"Keyboard",mouse:"Mouse"},monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},ru:{_lang:"Русский",name:"Имя",submit:"Отправить",equipment:{monitor:"Монитор",keyboard:"Клавиатура",mouse:"Мышь"},job:{title:"Работа"},monthsShort:["Янв","Фев","Мар","Апр","Мая","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"]}};this.lang=new JW.Property("en");this.locale=new JW.Plugins.Locale(this.dictionary,this.lang)},teardown:function(){this.locale.destroy();this.locale=null;this.lang.destroy();this.lang=null},testLocale:function(){this.assertTrue(JW.Array.equal(["en","ru"],this.locale.getLanguages()));this.assertStrictEqual("Name",this.locale.getString("name"));this.assertStrictEqual("Monitor",this.locale.getString("equipment.monitor"));this.assertStrictEqual("Feb",this.locale.getString(["monthsShort",1]));var d=this.locale.getSubLocale("equipment");this.assertStrictEqual("Monitor",d.getString("monitor"));var c=this.locale.getFunctor("submit");this.assertStrictEqual("Submit",c.target.get());var e=this.locale.getProperty("submit");this.assertStrictEqual("Submit",e.get());var g=d.getFunctor("monitor");this.assertStrictEqual("Monitor",g.target.get());var i=d.getProperty("monitor");this.assertStrictEqual("Monitor",i.get());var b=new Date(2010,0,1);var f=JW.Plugins.Locale.formatDate(b,"mmm'yy");this.assertStrictEqual("Jan'10",this.locale.expandTemplate(f));var h=this.locale.getTemplateFunctor(f);this.assertStrictEqual("Jan'10",h.target.get());var a=this.locale.getTemplateProperty(f);this.assertStrictEqual("Jan'10",a.get());this.lang.set("ru");this.assertStrictEqual("Имя",this.locale.getString("name"));this.assertStrictEqual("Монитор",this.locale.getString("equipment.monitor"));this.assertStrictEqual("Фев",this.locale.getString(["monthsShort",1]));this.assertStrictEqual("Монитор",d.getString("monitor"));this.assertStrictEqual("Отправить",c.target.get());this.assertStrictEqual("Отправить",e.get());this.assertStrictEqual("Монитор",g.target.get());this.assertStrictEqual("Монитор",i.get());this.assertStrictEqual("Янв'10",this.locale.expandTemplate(f));this.assertStrictEqual("Янв'10",h.target.get());this.assertStrictEqual("Янв'10",a.get());this.assertStrictEqual("English",this.locale.getString("en","_lang"));this.assertStrictEqual("Русский",this.locale.getString("ru","_lang"));this.assertStrictEqual("Jan'10",this.locale.expandTemplate("en",f));this.assertStrictEqual("Янв'10",this.locale.expandTemplate("ru",f));c.destroy();e.destroy();g.destroy();i.destroy();h.destroy();a.destroy()},testFunctorConfig:function(){var b=new JW.Property();var a=this.locale.getFunctor("submit",{target:b});this.assertStrictEqual(a.target,b);this.assertStrictEqual("Submit",b.get());this.lang.set("ru");this.assertStrictEqual("Отправить",b.get());a.destroy();this.lang.set("en");this.assertStrictEqual("Отправить",b.get());b.destroy()},testTemplateFunctorConfig:function(){var b=new Date(2010,0,1);var d=JW.Plugins.Locale.formatDate(b,"mmm'yy");var c=new JW.Property();var a=this.locale.getTemplateFunctor(d,{target:c});this.assertStrictEqual(a.target,c);this.assertStrictEqual("Jan'10",c.get());this.lang.set("ru");this.assertStrictEqual("Янв'10",c.get());a.destroy();this.lang.set("en");this.assertStrictEqual("Янв'10",c.get());c.destroy()},testMissingStrings:function(){this.assertFalse(this.locale.hasString("missing"));this.assertUndefined(this.locale.getRawString("missing"));this.assertStrictEqual("missing",this.locale.getString("missing"));this.assertFalse(this.locale.hasString("job.title"));this.assertUndefined(this.locale.getRawString("job.title"));this.assertStrictEqual("job.title",this.locale.getString("job.title"));this.assertFalse(this.locale.hasString(["job","title"]));this.assertStrictEqual("title",this.locale.getString(["job","title"]));var a=this.locale.getFunctor("job.title");this.assertStrictEqual("job.title",a.target.get());this.lang.set("ru");this.assertFalse(this.locale.hasString("missing"));this.assertUndefined(this.locale.getRawString("missing"));this.assertStrictEqual("missing",this.locale.getString("missing"));this.assertTrue(this.locale.hasString("job.title"));this.assertStrictEqual("Работа",this.locale.getRawString("job.title"));this.assertStrictEqual("Работа",this.locale.getString("job.title"));this.assertTrue(this.locale.hasString(["job","title"]));this.assertStrictEqual("Работа",this.locale.getString(["job","title"]));this.assertStrictEqual("Работа",a.target.get());this.assertUndefined(this.locale.getRawString("en","job.title"));this.assertStrictEqual("Работа",this.locale.getRawString("ru","job.title"));a.destroy()}});jQuery(function(){setTimeout(function(){JW.Unit.run("JW.Tests",JW.Tests)},1000)});