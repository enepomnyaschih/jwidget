/*!
	jWidget Locale plugin

	http://enepomnyaschih.github.io/jwidget/#!/api/JW.Plugins.Locale

	Copyright (C) 2015 Egor Nepomnyaschih

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Lesser General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Lesser General Public License for more details.

	You should have received a copy of the GNU Lesser General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
JW.Plugins=JW.Plugins||{};JW.Plugins.Locale=function(a,b){JW.Plugins.Locale._super.call(this);this.data=a;this.lang=b};JW.extend(JW.Plugins.Locale,JW.Class,{getLanguages:function(){return JW.Map.getKeys(this.data)},getRawString:function(a,b){if(!JW.isSet(b)){b=a;a=this.lang.get()}return JW.get(this.data[a],b)},hasString:function(a,b){return this.getRawString(a,b)!=null},getString:function(b,c){if(!JW.isSet(c)){c=b;b=this.lang.get()}var a=JW.get(this.data[b],c);return JW.isSet(a)?a:(typeof c==="string")?c:JW.Array.getLast(c)},getFunctor:function(b,a){return new JW.Functor([this.lang],function(c){return this.getString(b)},this,a)},getProperty:function(b){var a=new JW.Property();a.own(this.getFunctor(b,{target:a}));return a},getSubLocale:function(b){var a=JW.Map.map(this.data,function(c){return JW.get(c,b)},this);return new JW.Plugins.Locale(a,this.lang)},expandTemplate:function(c,a){if(!JW.isSet(a)){a=c;c=this.lang.get()}var b=this.data[c];return a.replace(/\$\{([^\}]+)\}/g,function(e,d){return JW.get(b,d,e)})},getTemplateFunctor:function(b,a){return new JW.Functor([this.lang],function(c){return this.expandTemplate(b)},this,a)},getTemplateProperty:function(b){var a=new JW.Property();a.own(this.getTemplateFunctor(b,{target:a}));return a}});JW.Plugins.Locale.formatDate=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[lq]|"[^"]*"|'[^']*'/g,b=function(d,c){d=String(d);c=c||2;while(d.length<c){d="0"+d}return d};return function(e,c,f){if(arguments.length==1&&Object.prototype.toString.call(e)=="[object String]"&&!/\d/.test(e)){c=e;e=undefined}e=e?new Date(e):new Date;if(isNaN(e)){throw SyntaxError("invalid date")}if(c.slice(0,4)=="UTC:"){c=c.slice(4);f=true}var d=f?"getUTC":"get";return c.replace(a,function(g){switch(g){case"d":return e[d+"Date"]();case"dd":return b(e[d+"Date"]());case"ddd":return"${daysShort."+e[d+"Day"]()+"}";case"dddd":return"${days."+e[d+"Day"]()+"}";case"m":return e[d+"Month"]()+1;case"mm":return b(e[d+"Month"]()+1);case"mmm":return"${monthsShort."+[e[d+"Month"]()]+"}";case"mmmm":return"${months."+[e[d+"Month"]()]+"}";case"yy":return String(e[d+"FullYear"]()).slice(2);case"yyyy":return e[d+"FullYear"]();case"q":return"Q"+(Math.floor(e[d+"Month"]()/3)+1);case"h":return e[d+"Hours"]()%12||12;case"hh":return b(e[d+"Hours"]()%12||12);case"H":return e[d+"Hours"]();case"HH":return b(e[d+"Hours"]());case"M":return e[d+"Minutes"]();case"MM":return b(e[d+"Minutes"]());case"s":return e[d+"Seconds"]();case"ss":return b(e[d+"Seconds"]());case"l":return b(e[d+"Milliseconds"](),3);case"t":return e[d+"Hours"]()<12?"a":"p";case"tt":return e[d+"Hours"]()<12?"am":"pm";case"T":return e[d+"Hours"]()<12?"A":"P";case"TT":return e[d+"Hours"]()<12?"AM":"PM";default:return g.slice(1,g.length-1)}})}}();