/*!
	jWidget UI 1.1.0

	http://enepomnyaschih.github.io/jwidget/#!/guide/home

	Copyright (C) 2014 Egor Nepomnyaschih

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Lesser General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Lesser General Public License for more details.

	You should have received a copy of the GNU Lesser General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
JW.UI={wrapMap:{option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]},rtagName:/^<([\w:]+)/,hash:new JW.Property(location.hash.substr(1)),template:function(a,b){b=JW.Map.map(b,function(c){return new JW.UI.Component.Template(c)});if(a.prototype.Templates&&a.prototype.Templates.componentCls==a){JW.apply(a.prototype.Templates.prototype,b)}else{a.prototype.Templates=(a.superclass.Templates||JW.Class).extend(b);a.prototype.Templates.componentCls=a;a.prototype.templates=new a.prototype.Templates()}},isElement:function(a){return a instanceof jQuery.fn.init},preventDefault:function(a){a.preventDefault()},isLifeInput:function(c){c=jQuery(c);var a=c[0].tagName.toLowerCase();if(a==="input"){var b=c.attr("type");return(b==="text")||(b!=="password")}return a==="textarea"},insert:function(b,c,a){if(!JW.isSet(a)||(a>=b.childNodes.length)){b.appendChild(c)}else{b.insertBefore(c,b.childNodes.item(a))}},remove:function(a){if(a.parentNode){a.parentNode.removeChild(a)}},parseHtml:function(c){if(JW.UI._fragment){JW.UI._fragment.textContent=""}else{JW.UI._fragment=document.createDocumentFragment()}var e=JW.UI._fragment.appendChild(document.createElement("div"));var b=JW.UI.rtagName.exec(c)[1];var d=JW.UI.wrapMap[b]||JW.UI.wrapMap._default;e.innerHTML=d[1]+c+d[2];for(var a=0;a<d[0];++a){e=e.firstChild}return e.firstChild},hasClass:function(b,a){return(" "+b.className+" ").indexOf(a)!==-1},addClass:function(b,a){if(!b.className){b.className=a}else{if(!JW.UI.hasClass(b,a)){b.className+=" "+a}}},inDom:function(a){while(a){if(a.tagName.toLowerCase()==="body"){return true}a=a.parentNode}return false},replace:function(d,f,b){var c=d.parentNode;if(!c){return}var e=b?d.getAttribute("id"):null,a=b?d.getAttribute("class"):null;c.replaceChild(f,d);if(e){f.setAttribute("id",e)}if(a){JW.UI.addClass(f,a)}},_afterAppend:function(a){a._afterAppend()}};(function(a){a.optgroup=a.option;a.tbody=a.tfoot=a.colgroup=a.caption=a.thead;a.th=a.td})(JW.UI.wrapMap);jQuery(function(){JW.UI.windowEl=jQuery(window);JW.UI.bodyEl=jQuery(document.body);jQuery(window).bind("hashchange",function(){JW.UI.hash.set(location.hash.substr(1))})});JW.UI.Browsers=(function(){ua=navigator.userAgent.toLowerCase();function y(H){return H.test(ua)}var j=document.compatMode=="CSS1Compat",l=document.documentMode,C=y(/opera/),n=C&&y(/version\/10\.5/),g=y(/\bchrome\b/),t=y(/webkit/),x=!g&&y(/safari/),f=x&&y(/applewebkit\/4/),c=x&&y(/version\/3/),G=x&&y(/version\/4/),E=x&&y(/version\/5/),s=!C&&y(/msie/),q=s&&(y(/msie 7/)||l==7),p=s&&(y(/msie 8/)&&l!=7&&l!=9||l==8),o=s&&(y(/msie 9/)&&l!=7&&l!=8||l==9),r=s&&y(/msie 6/),m=!t&&y(/gecko/),e=m&&y(/rv:1\.8/),b=m&&y(/rv:1\.9/),F=m&&y(/rv:2\.0/),D=m&&y(/rv:5\./),a=b&&y(/rv:1\.9\.0/),B=b&&y(/rv:1\.9\.1/),A=b&&y(/rv:1\.9\.2/),w=s&&!j,z=y(/windows|win32/),i=y(/macintosh|mac os x/),h=y(/adobeair/),k=y(/linux/),v=y(/ipad/),d=/^https/i.test(window.location.protocol);var u=!(t||v);return{isStrict:j,isOpera:C,isOpera10_5:n,isChrome:g,isWebKit:t,isSafari:x,isSafari2:f,isSafari3:c,isSafari4:G,isSafari5:E,isIE:s,isIE7:q,isIE8:p,isIE9:o,isIE6:r,isGecko:m,isGecko2:e,isGecko3:b,isGecko4:F,isGecko5:D,isFF3_0:a,isFF3_5:B,isFF3_6:A,isBorderBox:w,isWindows:z,isMac:i,isAir:h,isLinux:k,isIPad:v,isSecure:d,isPaddingWideTd:u}})();JW.UI.Inserter=function(b,a){JW.UI.Inserter._super.call(this);this.el=a;this.len=0;this.own(b.createInserter({addItem:this._addItem,removeItem:this._removeItem,scope:this}))};JW.extend(JW.UI.Inserter,JW.Class,{_getElement:function(a){return a},_addItem:function(c,a){var b=this.el;var d=this._getElement(c);if(a===this.len){b.appendChild(d)}else{b.insertBefore(d,b.childNodes.item(a))}++this.len},_removeItem:function(a){--this.len;JW.UI.remove(this._getElement(a))}});JW.UI.Component=function(){JW.UI.Component._super.call(this);this.parent=null;this.wasAfterAppend=false;this.el=null;this.children=null;this._template=this.templates.main;this._elements=null;this._replaceables=null;this._arrays=null},JW.extend(JW.UI.Component,JW.Class,{destroy:function(){if(this.parent){throw new Error("JW.UI.Component.destroy must be used for root and detached components only")}if(this.wasAfterAppend){this.releaseDom()}if(this.el){JW.UI.remove(this.el[0]);JW.Set.each(this._arrays,JW.destroy);this._arrays=null;JW.Set.each(this._replaceables,JW.destroy);this._replaceables=null;this.children.unrender();this.unrender();this.children.destroy();this.children=null;this.el.remove()}this._elements=null;this.el=null;this.afterDestroy();this._super()},beforeRender:function(){},afterRender:function(){},afterAppend:function(){},releaseDom:function(){},unrender:function(){},afterDestroy:function(){},using:function(a){this._template=(typeof a==="string")?new JW.UI.Component.Template(a):(a instanceof JW.UI.Component.Template)?a:new JW.UI.Component.DomTemplate(a);return this},render:function(){if(this.el){return}var c=this._template.createElement();this.el=jQuery(c.root);this._elements=JW.Map.map(c.groups,jQuery);this.children=new JW.UI.Component.Children(this);this._replaceables={};this._arrays={};this.beforeRender();var e=JW.apply({},this._elements);for(var f in e){var b=JW.String.camel(f);var d="render"+JW.String.capitalize(b);if(typeof this[d]==="function"){var a=this[d](e[f]);if(f==="root"){if(a instanceof JW.AbstractArray){this.addArray(a,f)}}else{if(a instanceof JW.UI.Component){this.children.set(a,f)}else{if(a instanceof JW.Property){this.addReplaceable(a,f)}else{if(a instanceof JW.AbstractArray){this.addArray(a,f)}else{if(a===false){this.removeElement(f)}}}}}}}this.afterRender();if(this._template.requiresAfterAppend){this._afterAppend()}return this},renderTo:function(a){this.render();jQuery(a)[0].appendChild(this.el[0]);this._afterAppend();return this},renderAs:function(a){this.render();JW.UI.replace(jQuery(a)[0],this.el[0],true);this._afterAppend();return this},remove:function(){if(this.parent){throw new Error("JW.UI.Component.remove must be used for root components only")}JW.UI.remove(this.el[0]);return this},getElement:function(a){return this._elements[a]},removeElement:function(b){var a=this._elements[b];if(!a){return}a.remove();delete this._elements[b]},addReplaceable:function(a,b){return new JW.UI.Component.Replaceable(this,a,b)},addArray:function(b,a){return new JW.UI.Component.Array(this,b,(a===undefined)?this.el:(typeof a==="string")?this._elements[a]:jQuery(a))},_afterAppend:function(){if(this.wasAfterAppend||!this.el){return}if(this.parent&&!this.parent.wasAfterAppend){return}if(!this.parent&&!JW.UI.inDom(this.el[0])){return}this.wasAfterAppend=true;this.afterAppend();this.children.each(JW.UI._afterAppend);JW.Set.each(this._arrays,JW.UI._afterAppend)},_initChild:function(a){a.render();a.parent=this},_doneChild:function(a){a.parent=null}});JW.UI.Component.EventParams=function(a){JW.UI.Component.EventParams._super.call(this,a)};JW.extend(JW.UI.Component.EventParams,JW.EventParams,{});JW.UI.Component.AbstractTemplate=function(){JW.UI.Component.AbstractTemplate._super.call(this);this.prefixes=null};JW.extend(JW.UI.Component.AbstractTemplate,JW.Class,{_compileAttributes:function(b){this.prefixes=JW.String.parseClass(b.getAttribute("jwclass"));
b.removeAttribute("jwclass");for(var c=0,a=this.prefixes.length;c<a;++c){JW.UI.addClass(b,this.prefixes[c])}var d=[];this._walk(b,d,function(g,q){var p=g.getAttribute("jwid");if(!p){return}var e=JW.String.parseClass(p);g.removeAttribute("jwid");for(var o=0,k=e.length;o<k;++o){var f=e[o];for(var m=0,h=this.prefixes.length;m<h;++m){JW.UI.addClass(g,this.prefixes[m]+"-"+f)}this._addElement(f,g,q)}},this);this._addElement("root",b,[])},_walk:function(e,f,h,d){if(e.nodeType!==1){return}h.call(d,e,f);var b=f.length;f.push(0);var g=e.childNodes;for(var c=0,a=g.length;c<a;++c){f[b]=c;this._walk(g[c],f,h,d)}f.pop()}});JW.UI.Component.Array=function(b,c,a){JW.UI.Component.Array._super.call(this);this.parent=b;this.source=c;JW.Set.add(b._arrays,this);var d=this.own(c.createMapper({createItem:function(e){this.parent._initChild(e);return e},destroyItem:function(e){this.parent._doneChild(e)},scope:this}));this.own(new JW.UI.Component.Inserter(d.target,a[0]))};JW.extend(JW.UI.Component.Array,JW.Class,{destroy:function(){JW.Set.remove(this.parent._arrays,this);this._super()},_afterAppend:function(){this.source.each(JW.UI._afterAppend)}});JW.UI.Component.Child=function(a,b){JW.UI.Component.Child._super.call(this);this.parent=a;this.child=b;this.name=null;this._el=null};JW.extend(JW.UI.Component.Child,JW.Class,{attach:function(a){this.name=a;this._el=this.parent._elements[a];this.parent._initChild(this.child);this.parent._elements[a]=this.child.el;JW.UI.replace(this._el[0],this.child.el[0],true);this.child._afterAppend()},detach:function(){if(this.parent._elements[this.name]===this.child.el){this.parent._elements[this.name]=this._el}JW.UI.replace(this.child.el[0],this._el[0]);this.parent._doneChild(this.child);this._el=null;this.name=null}});JW.UI.Component.ChildInserter=function(){JW.UI.Component.ChildInserter._super.call(this)};JW.extend(JW.UI.Component.ChildInserter,JW.AbstractMap,{trySplice:function(a,b){var c=this._super(a,b);if(c===undefined){return}JW.Map.each(c.removedItems,this._detach,this);JW.Map.each(c.addedItems,this._attach,this);return c},tryClear:function(){var a=this._super();if(a===undefined){return}JW.Map.each(a,this._detach,this);return a},tryReindex:function(e){var a=this._super(e);if(a===undefined){return}for(var c in e){var d=e[c];var b=this.get(d);b.detach();b.attach(d)}return a},_attach:function(b,a){b.attach(a)},_detach:function(a){a.detach()}});JW.UI.Component.Children=function(a){JW.UI.Component.Children._super.call(this);this.component=a;this.target=new JW.UI.Component.ChildInserter()};JW.extend(JW.UI.Component.Children,JW.AbstractMap,{unrender:function(){this.target.destroy()},trySplice:function(e,f){var g=this._super(e,f);if(g===undefined){return}var b=g.removedItems;var d=g.addedItems;var c=JW.Map.map(d,function(h){return new JW.UI.Component.Child(this.component,h)},this);var a=this.target.trySplice(JW.Map.getRemovedKeys(b,d),c);return g},tryClear:function(){var a=this._super();if(a===undefined){return}this.target.tryClear();return a},tryReindex:function(b){var a=this._super(b);if(a===undefined){return}this.target.tryReindex(b);return a}});JW.UI.Component.DomTemplate=function(a){JW.UI.Component.DomTemplate._super.call(this);this.el=jQuery(a)[0];this.output=null};JW.extend(JW.UI.Component.DomTemplate,JW.UI.Component.AbstractTemplate,{requiresAfterAppend:true,createElement:function(){if(this.output!==null){return this.output}this.output=new JW.UI.Component.TemplateOutput(this.el,{});this._compileAttributes(this.el);return this.output},_addElement:function(d,b,c){var a=this.output.groups;a[d]=a[d]||[];a[d].push(b)}});JW.UI.Component.Inserter=function(b,a){JW.UI.Component.Inserter._super.call(this,b,a)};JW.extend(JW.UI.Component.Inserter,JW.UI.Inserter,{_getElement:function(a){return a.el[0]},_addItem:function(b,a){this._super(b,a);b._afterAppend()}});JW.UI.Component.Replaceable=function(b,a,c){JW.UI.Component.Replaceable._super.call(this);this.parent=b;this.id=c;JW.Set.add(b._replaceables,this);this.own(new JW.Switcher([a],{init:function(d){this.parent.children.set(d,this.id)},done:function(){this.parent.children.remove(this.id)},scope:this}))};JW.extend(JW.UI.Component.Replaceable,JW.Class,{destroy:function(){JW.Set.remove(this.parent._replaceables,this);this._super()}});JW.UI.Component.Template=function(a){JW.UI.Component.Template._super.call(this);this.html=a;this.mirror=null;this.groups=null};JW.extend(JW.UI.Component.Template,JW.UI.Component.AbstractTemplate,{requiresAfterAppend:false,createElement:function(){this._compile();var g=this.mirror.cloneNode(true);var d={};for(var a in this.groups){var l=this.groups[a];var k=l.length;var h=new Array(k);for(var f=0;f<k;++f){var m=l[f];var b=g;for(var e=0,c=m.length;e<c;++e){b=b.childNodes[m[e]]}h[f]=b}d[a]=h}return new JW.UI.Component.TemplateOutput(g,d)},_compile:function(){if(this.mirror!==null){return}this.mirror=JW.UI.parseHtml(this.html);this.groups={};this._compileAttributes(this.mirror)},_addElement:function(c,a,b){this.groups[c]=this.groups[c]||[];this.groups[c].push(b.concat())}});JW.UI.template(JW.UI.Component,{main:"<div></div>"});JW.UI.Component.TemplateOutput=function(b,a){JW.UI.Component.TemplateOutput._super.call(this);this.root=b;this.groups=a};JW.extend(JW.UI.Component.TemplateOutput,JW.Class,{});JW.UI.Params={};(function(){if(!location.search.length){return}var c=location.search.substr(1).split("&");for(var a=0;a<c.length;++a){var b=c[a].split("=");if(b.length!=2){continue}JW.UI.Params[b[0]]=decodeURIComponent(b[1]).replace(/\+/g," ")}})();JW.UI.preloadImage=function(c,d,a){var b=new Image();jQuery(b).load(function(){if(typeof d==="function"){d.call(a,b)}}).error(function(){if(typeof d==="function"){d.call(a)}}).attr("src",c)};JW.UI.AttrUpdater=function(b,a,c){JW.UI.AttrUpdater._super.call(this);this.el=jQuery(b);this.attr=a;this.property=c;this._update();this.own(c.changeEvent.bind(this._update,this))};JW.extend(JW.UI.AttrUpdater,JW.Class,{_update:function(){this.el.attr(this.attr,this.property.get())}});JW.UI.CheckedListener=function(b,a){this._update=JW.inScope(this._update,this);JW.UI.CheckedListener._super.call(this);a=(a instanceof JW.Property)?{target:a}:(a||{});this.el=jQuery(b);this.target=a.target||this.own(new JW.Property());this.property=this.target;this._update();this.el.bind("change",this._update)};JW.extend(JW.UI.CheckedListener,JW.Class,{destroy:function(){this.el.unbind("change",this._update);this._super()},_update:function(){this.target.set(this.el.prop("checked"))}});JW.UI.ClassUpdater=function(b,a,c){JW.UI.ClassUpdater._super.call(this);this.el=jQuery(b);this.cls=a;this.property=c;this._update();this.own(c.changeEvent.bind(this._update,this))};JW.extend(JW.UI.ClassUpdater,JW.Class,{_update:function(){this.el.toggleClass(this.cls,!!this.property.get())}});JW.UI.CssUpdater=function(b,a,c){JW.UI.CssUpdater._super.call(this);this.el=jQuery(b);this.style=a;this.property=c;this._update();this.own(c.changeEvent.bind(this._update,this))};JW.extend(JW.UI.CssUpdater,JW.Class,{_update:function(){this.el.css(this.style,this.property.get())}});JW.UI.HtmlUpdater=function(a,b){JW.UI.HtmlUpdater._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.HtmlUpdater,JW.Class,{_update:function(){this.el.html(this.property.get())}});JW.UI.PropUpdater=function(a,c,b){JW.UI.PropUpdater._super.call(this);this.el=jQuery(a);this.prop=c;this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.PropUpdater,JW.Class,{_update:function(){this.el.prop(this.prop,this.property.get());if(this.prop==="checked"){this.el.change()}}});JW.UI.RadioListener=function(c,b,a){this._update=JW.inScope(this._update,this);JW.UI.RadioListener._super.call(this);a=(a instanceof JW.Property)?{target:a}:(a||{});this.el=jQuery(c);this.name=b;this.target=a.target||this.own(new JW.Property());this.property=this.target;this._selector="input[type=radio][name='"+b+"']";this._update();this.el.on("change",this._selector,this._update)
};JW.extend(JW.UI.RadioListener,JW.Class,{destroy:function(){this.el.off("change",this._selector,this._update);this._super()},_update:function(){var a=this.el.find(this._selector+":checked");this.target.set((a.length!==0)?a.attr("value"):null)}});JW.UI.RadioUpdater=function(b,a,c){JW.UI.RadioUpdater._super.call(this);this.el=jQuery(b);this.name=a;this.property=c;this._selector="input[type=radio][name='"+a+"']";this._update();this.own(c.changeEvent.bind(this._update,this))};JW.extend(JW.UI.RadioUpdater,JW.Class,{_update:function(){var b=this.property.get();if(JW.isSet(b)){var a=this.el.find(this._selector+"[value='"+b+"']");if(a.length!==0){a.prop("checked",true).change();return}}this.el.find(this._selector+":checked").prop("checked",false).change()}});JW.UI.TextUpdater=function(a,b){JW.UI.TextUpdater._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.TextUpdater,JW.Class,{_update:function(){this.el[0].textContent=this.property.get()}});JW.UI.ValueListener=function(b,a,c){this._update=JW.inScope(this._update,this);JW.UI.ValueListener._super.call(this);a=(a instanceof JW.Property)?{target:a,simple:c}:(a||{});this.el=jQuery(b);this.target=a.target||this.own(new JW.Property());this.property=this.target;this.simple=a.simple||!JW.UI.isLifeInput(b);this._update();this.el.bind("change",this._update);if(!this.simple){this._timer=setInterval(this._update,100)}};JW.extend(JW.UI.ValueListener,JW.Class,{destroy:function(){if(!this.simple){clearInterval(this._timer)}this.el.unbind("change",this._update);this._super()},_update:function(){this.target.set(this.el.val())}});JW.UI.ValueUpdater=function(a,b){JW.UI.ValueUpdater._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.ValueUpdater,JW.Class,{_update:function(){this.el.val(this.property.get())}});JW.UI.VisibleUpdater=function(a,b){JW.UI.VisibleUpdater._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.VisibleUpdater,JW.Class,{_update:function(){this.el.css("display",this.property.get()?"":"none")}});