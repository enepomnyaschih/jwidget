/*!
	jWidget UI 0.9.0
	
	http://enepomnyaschih.github.io/jwidget/#!/guide/home
	
	Copyright (C) 2014 Egor Nepomnyaschih
	
	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Lesser General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Lesser General Public License for more details.
	
	You should have received a copy of the GNU Lesser General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
JW.UI={hash:new JW.Property(location.hash.substr(1)),template:function(a,b){if(a.prototype.Templates&&a.prototype.Templates.componentCls==a){JW.apply(a.prototype.Templates.prototype,b)}else{a.prototype.Templates=(a.superclass.Templates||JW.Class).extend(b);a.prototype.Templates.componentCls=a;a.prototype.templates=new a.prototype.Templates()}},isElement:function(a){return a instanceof jQuery.fn.init},preventDefault:function(a){a.preventDefault()},isLifeInput:function(c){c=jQuery(c);var a=c[0].tagName.toLowerCase();if(a==="input"){var b=c.attr("type");return(b==="text")||(b!=="password")}return a==="textarea"}};jQuery(function(){JW.UI.windowEl=jQuery(window);JW.UI.bodyEl=jQuery(document.body);jQuery(window).bind("hashchange",function(){JW.UI.hash.set(location.hash.substr(1))})});JW.apply(jQuery.fn,{insert:function(c,b){var a=this.eq(0);c=jQuery(c).eq(0);if(!JW.isSet(b)){a.append(c)}else{if(b==0){a.prepend(c)}else{jQuery(a.children()[b-1]).after(c)}}return this},replaceBy:function(d,c){var b=this.eq(0);var e=c?b.attr("id"):null,a=c?b.attr("class"):null;d=jQuery(d).eq(0);b.after(d);b.detach();if(e){d.attr("id",e)}if(a){d.addClass(a)}return this}});JW.UI.Browsers=(function(){ua=navigator.userAgent.toLowerCase();function y(H){return H.test(ua)}var j=document.compatMode=="CSS1Compat",l=document.documentMode,C=y(/opera/),n=C&&y(/version\/10\.5/),g=y(/\bchrome\b/),t=y(/webkit/),x=!g&&y(/safari/),f=x&&y(/applewebkit\/4/),c=x&&y(/version\/3/),G=x&&y(/version\/4/),E=x&&y(/version\/5/),s=!C&&y(/msie/),q=s&&(y(/msie 7/)||l==7),p=s&&(y(/msie 8/)&&l!=7&&l!=9||l==8),o=s&&(y(/msie 9/)&&l!=7&&l!=8||l==9),r=s&&y(/msie 6/),m=!t&&y(/gecko/),e=m&&y(/rv:1\.8/),b=m&&y(/rv:1\.9/),F=m&&y(/rv:2\.0/),D=m&&y(/rv:5\./),a=b&&y(/rv:1\.9\.0/),B=b&&y(/rv:1\.9\.1/),A=b&&y(/rv:1\.9\.2/),w=s&&!j,z=y(/windows|win32/),i=y(/macintosh|mac os x/),h=y(/adobeair/),k=y(/linux/),v=y(/ipad/),d=/^https/i.test(window.location.protocol);var u=!(t||v);return{isStrict:j,isOpera:C,isOpera10_5:n,isChrome:g,isWebKit:t,isSafari:x,isSafari2:f,isSafari3:c,isSafari4:G,isSafari5:E,isIE:s,isIE7:q,isIE8:p,isIE9:o,isIE6:r,isGecko:m,isGecko2:e,isGecko3:b,isGecko4:F,isGecko5:D,isFF3_0:a,isFF3_5:B,isFF3_6:A,isBorderBox:w,isWindows:z,isMac:i,isAir:h,isLinux:k,isIPad:v,isSecure:d,isPaddingWideTd:u}})();JW.UI.Component=function(a){JW.UI.Component._super.call(this);a=a||{};this.rootClass=a.rootClass;this.template=a.template;this.parent=null;this.wasAfterAppend=false;this.destroyed=false;this.el=null;this.replacedEl=null;this.children=null;this.allChildren=null;this._elements=null;this._childMapper=null;this._childInserter=null;this._replaceables=null;this._arrays=null},JW.extend(JW.UI.Component,JW.Class,{destroy:function(){if(this.parent){throw new Error("JW.UI.Component.destroy must be used for root and detached components only")}if(this.destroyed){return}this.destroyed=true;if(this.el){this.el.detach();JW.Set.each(this._arrays,JW.destroy);this._arrays=null;JW.Set.each(this._replaceables,JW.destroy);this._replaceables=null;this._childInserter.destroy();this._childInserter=null;this._childMapper.destroy();this._childMapper=null;this.destroyComponent();this.children.destroy();this.children=null;this.el.remove()}this.allChildren=null;this._elements=null;this.el=null;this.destroyObject();this._super()},beforeRender:function(){},renderComponent:function(){},afterAppend:function(){},destroyComponent:function(){},destroyObject:function(){},render:function(n){if(this.el){return}this.replacedEl=n;this.el=jQuery(this.template||this.templates.main);this._elements={};this._elements.root=this.el;this.allChildren={};this.children=new JW.ObservableMap();this._replaceables={};this._arrays={};this.rootClass=JW.String.parseClass(this.rootClass||this.el.attr("jwclass"));this.el.removeAttr("jwclass");this.el.addClass(this.rootClass.join(" "));var l=this.el.find("[jwid]");for(var e=0;e<l.length;++e){var g=jQuery(l[e]);var m=JW.String.trim(g.attr("jwid")).split(/\s+/);g.removeAttr("jwid");for(var d=0;d<m.length;++d){var f=m[d];this._elements[f]=this._elements[f]?this._elements[f].add(g):g;for(var b=0;b<this.rootClass.length;++b){g.addClass(this.rootClass[b]+"-"+f)}}}this._childMapper=this.children.createMapper({createItem:function(i){return new JW.UI.Component.Child(this,i)},destroyItem:function(i){i.destroy()},scope:this});this._childInserter=this._childMapper.target.createInserter({addItem:function(j,i){j.attach(i)},removeItem:function(i,j){j.detach()},scope:this});this.beforeRender();var a=JW.apply({},this._elements);for(var f in a){var g=a[f];var c=JW.String.camel(f);var h="render"+JW.String.capitalize(c);if(typeof this[h]==="function"){var o=this[h](g);if(f==="root"){if(o instanceof JW.AbstractArray){this.addArray(o,f)}}else{if(o instanceof JW.UI.Component){this.children.set(o,f)}else{if(o instanceof JW.Property){this.addReplaceable(o,f)}else{if(o instanceof JW.AbstractArray){this.addArray(o,f)}else{if(o===false){this.removeElement(f)}}}}}}}this.renderComponent()},renderTo:function(a){this.render();jQuery(a).insert(this.el);this._afterAppend()},renderAs:function(a){this.render(a);jQuery(a).replaceBy(this.el,true);this._afterAppend()},remove:function(){if(this.parent){throw new Error("JW.UI.Component.remove must be used for root components only")}this.el.detach()},getElement:function(a){return this._elements[a]},setElement:function(a,b){this._elements[b]=a},removeElement:function(b){var a=this._elements[b];if(!a){return}a.remove();delete this._elements[b]},addReplaceable:function(a,b){return new JW.UI.Component.Replaceable(this,a,b)},addArray:function(b,a){return new JW.UI.Component.Array(this,b,this._getElement(a))},_afterAppend:function(){if(this.wasAfterAppend||!this.el){return}if(this.parent&&!this.parent.wasAfterAppend){return}if(!this.parent&&!this.el.parents("body").length){return}this.wasAfterAppend=true;this.afterAppend();JW.Set.each(this.allChildren,JW.byMethod("_afterAppend"))},_initChild:function(b,a){b.render(a);b.parent=this;JW.Set.add(this.allChildren,b)},_doneChild:function(a){JW.Set.remove(this.allChildren,a);a.parent=null},_getElement:function(a){return(typeof a==="string")?this.getElement(a):(a||this.el)}});JW.UI.template(JW.UI.Component,{main:"<div />"});JW.UI.Component.EventParams=function(a){JW.UI.Component.EventParams._super.call(this,a)};JW.extend(JW.UI.Component.EventParams,JW.EventParams,{});JW.UI.Component.Array=function(b,c,a){JW.UI.Component.Array._super.call(this);this.parent=b;JW.Set.add(b._arrays,this);var d=this.own(c.createMapper({createItem:function(e){this.parent._initChild(e);return e},destroyItem:function(e){this.parent._doneChild(e)},scope:this}));this.own(new JW.UI.Inserter(d.target,a))};JW.extend(JW.UI.Component.Array,JW.Class,{destroy:function(){JW.Set.remove(this.parent._arrays,this);this._super()}});JW.UI.Component.Child=function(a,b){JW.UI.Component.Child._super.call(this);this.parent=a;this.child=b;this.name=null;this._el=null};JW.extend(JW.UI.Component.Child,JW.Class,{attach:function(a){this.name=a;this._el=this.parent.getElement(a);this.parent._initChild(this.child,this._el);this.parent._elements[a]=this.child.el;this._el.replaceBy(this.child.el,true);this.child._afterAppend()},detach:function(){if(this.parent._elements[this.name]===this.child.el){this.parent._elements[this.name]=this._el
}this.child.el.replaceBy(this._el);this.parent._doneChild(this.child);this._el=null;this.name=null}});JW.UI.Component.Replaceable=function(b,a,c){JW.UI.Component.Replaceable._super.call(this);this.parent=b;this.id=c;JW.Set.add(b._replaceables,this);this.own(new JW.Switcher([a],{init:function(d){this.parent.children.set(d,this.id)},done:function(){this.parent.children.remove(this.id)},scope:this}))};JW.extend(JW.UI.Component.Replaceable,JW.Class,{destroy:function(){JW.Set.remove(this.parent._replaceables,this);this._super()}});JW.UI.Inserter=function(b,a){JW.UI.Inserter._super.call(this);this.el=a;this.own(b.createInserter({addItem:this._addItem,removeItem:this._removeItem,scope:this}))};JW.extend(JW.UI.Inserter,JW.Class,{_addItem:function(b,a){this.el.insert(b.el,a);b._afterAppend()},_removeItem:function(a){a.el.detach()}});JW.UI.Params={};(function(){if(!location.search.length){return}var c=location.search.substr(1).split("&");for(var a=0;a<c.length;++a){var b=c[a].split("=");if(b.length!=2){continue}JW.UI.Params[b[0]]=decodeURIComponent(b[1]).replace(/\+/g," ")}})();JW.UI.preloadImage=function(c,d,a){var b=new Image();jQuery(b).load(function(){if(typeof d==="function"){d.call(a,b)}}).error(function(){if(typeof d==="function"){d.call(a)}}).attr("src",c)};JW.UI.AttrUpdater=function(b,a,c){JW.UI.AttrUpdater._super.call(this);this.el=jQuery(b);this.attr=a;this.property=c;this._update();this.own(c.changeEvent.bind(this._update,this))};JW.extend(JW.UI.AttrUpdater,JW.Class,{_update:function(){this.el.attr(this.attr,this.property.get())}});JW.UI.CheckedListener=function(a,b){this._update=JW.inScope(this._update,this);JW.UI.CheckedListener._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.el.bind("change",this._update)};JW.extend(JW.UI.CheckedListener,JW.Class,{destroy:function(){this.el.unbind("change",this._update);this._super()},_update:function(){this.property.set(this.el.prop("checked"))}});JW.UI.ClassUpdater=function(b,a,c){JW.UI.ClassUpdater._super.call(this);this.el=jQuery(b);this.cls=a;this.property=c;this._update();this.own(c.changeEvent.bind(this._update,this))};JW.extend(JW.UI.ClassUpdater,JW.Class,{_update:function(){this.el.toggleClass(this.cls,this.property.get())}});JW.UI.CssUpdater=function(b,a,c){JW.UI.CssUpdater._super.call(this);this.el=jQuery(b);this.style=a;this.property=c;this._update();this.own(c.changeEvent.bind(this._update,this))};JW.extend(JW.UI.CssUpdater,JW.Class,{_update:function(){this.el.css(this.style,this.property.get())}});JW.UI.HtmlUpdater=function(a,b){JW.UI.HtmlUpdater._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.HtmlUpdater,JW.Class,{_update:function(){this.el.html(this.property.get())}});JW.UI.PropUpdater=function(a,c,b){JW.UI.PropUpdater._super.call(this);this.el=jQuery(a);this.prop=c;this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.PropUpdater,JW.Class,{_update:function(){this.el.prop(this.prop,this.property.get());if(this.prop==="checked"){this.el.change()}}});JW.UI.RadioListener=function(b,a,c){this._update=JW.inScope(this._update,this);JW.UI.RadioListener._super.call(this);this.el=jQuery(b);this.name=a;this.property=c;this._selector="input[type=radio][name='"+a+"']";this._update();this.el.on("change",this._selector,this._update)};JW.extend(JW.UI.RadioListener,JW.Class,{destroy:function(){this.el.off("change",this._selector,this._update);this._super()},_update:function(){var a=this.el.find(this._selector+":checked");this.property.set((a.length!==0)?a.attr("value"):null)}});JW.UI.RadioUpdater=function(b,a,c){JW.UI.RadioUpdater._super.call(this);this.el=jQuery(b);this.name=a;this.property=c;this._selector="input[type=radio][name='"+a+"']";this._update();this.own(c.changeEvent.bind(this._update,this))};JW.extend(JW.UI.RadioUpdater,JW.Class,{_update:function(){var a=this.property.get();if(JW.isSet(a)){this.el.find(this._selector+"[value='"+a+"']").prop("checked",true).change()}else{this.el.find(this._selector+":checked").prop("checked",false).change()}}});JW.UI.TextUpdater=function(a,b){JW.UI.TextUpdater._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.TextUpdater,JW.Class,{_update:function(){this.el.text(this.property.get())}});JW.UI.ValueListener=function(a,b,c){this._update=JW.inScope(this._update,this);JW.UI.ValueListener._super.call(this);this.el=jQuery(a);this.property=b;this.simple=c||!JW.UI.isLifeInput(a);this._update();this.el.bind("change",this._update);if(!this.simple){this._timer=this.own(setInterval(this._update,100))}};JW.extend(JW.UI.ValueListener,JW.Class,{destroy:function(){if(!this.simple){clearInterval(this._timer)}this.el.unbind("change",this._update);this._super()},_update:function(){this.property.set(this.el.val())}});JW.UI.ValueUpdater=function(a,b){JW.UI.ValueUpdater._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.ValueUpdater,JW.Class,{_update:function(){this.el.val(this.property.get())}});JW.UI.VisibleUpdater=function(a,b){JW.UI.VisibleUpdater._super.call(this);this.el=jQuery(a);this.property=b;this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.UI.VisibleUpdater,JW.Class,{_update:function(){this.el.css("display",this.property.get()?"":"none")}});