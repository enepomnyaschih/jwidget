/*!
	jWidget Lib 1.1.0

	http://enepomnyaschih.github.io/jwidget/#!/guide/home

	Copyright (C) 2014 Egor Nepomnyaschih

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Lesser General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Lesser General Public License for more details.

	You should have received a copy of the GNU Lesser General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
if(typeof JW!=="undefined"){throw new Error("Can't initialize jWidget Lib: JW namespace already defined")}(typeof window==="undefined"?global:window).JW={};JW.global=(typeof window==="undefined"?global:window);JW.apply=function(d){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(!c){continue}for(var a in c){if(typeof c[a]!=="undefined"){d[a]=c[a]}}}return d};JW.apply(JW,{isUndefined:function(a){return a===undefined},isDefined:function(a){return a!==undefined},isNull:function(a){return a===null},isNotNull:function(a){return a!==null},isSet:function(a){return(a!==undefined)&&(a!==null)},isNotSet:function(a){return(a===undefined)||(a===null)},isBlank:function(a){return !a},isNotBlank:function(a){return Boolean(a)},isInt:function(a){return(typeof a==="number")&&Math.round(a)===a},isNumber:function(a){return typeof a==="number"},isString:function(a){return typeof a==="string"},isBoolean:function(a){return typeof a==="boolean"},isFunction:function(a){return typeof a==="function"},isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},isObject:function(a){return Object.prototype.toString.apply(a)==="[object Object]"},isRegExp:function(a){return Object.prototype.toString.apply(a)==="[object RegExp]"},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},def:function(a,b){return JW.isDefined(a)?a:b},defn:function(a,b){return JW.isSet(a)?a:b},applyIf:function(d){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(!c){continue}for(var a in c){if(JW.isDefined(c[a])&&!JW.isDefined(d[a])){d[a]=c[a]}}}return d},applyIfn:function(d){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(!c){continue}for(var a in c){if(JW.isDefined(c[a])&&!JW.isSet(d[a])){d[a]=c[a]}}}return d},clean:function(c){var a={};for(var b in c){if(JW.isDefined(c[b])){a[b]=c[b]}}return a},cleann:function(c){var a={};for(var b in c){if(JW.isSet(c[b])){a[b]=c[b]}}return a},args:function(b,c,f){c=c||0;f=f||(b.length-c);var e=[];for(var d=0;d<f;++d){e.push(b[c+d])}return e},emptyFn:function(){},cmp:function(b,c,a){if(typeof b==="boolean"&&typeof c==="boolean"){return b?(c?0:1):(c?-1:0)}if(JW.isArray(b)&&JW.isArray(c)){return JW.Array.cmp(b,c,a)}if(a){if(typeof b==="string"){b=b.toLowerCase()}if(typeof c==="string"){c=c.toLowerCase()}}if(b>c){return 1}if(b<c){return -1}return 0},cmpCaseInsensitive:function(a,b){return JW.cmp(a,b,true)},get:function(e,d,c){if(!d){return JW.def(e,c)}if(typeof d==="string"){d=d.split(".")}d=JW.Array.filter(d,function(f){return JW.isSet(f)&&(f!=="")});for(var b=0,a=d.length;b<a;++b){if(!e){return c}e=e[d[b]]}return JW.def(e,c)},set:function(e,c,d){if(!d){return}if(typeof d==="string"){d=d.split(".")}d=JW.Array.filter(d,function(f){return JW.isSet(f)&&(f!=="")});for(var b=0,a=d.length-1;b<a;++b){token=d[b];e[token]=e[token]||{};e=e[token]}e[JW.Array.getLast(d)]=c},iid:function(a){return(typeof a==="object")?a._iid:a},destroy:function(a){a.destroy()},mod:function(b,a){return b-a*Math.floor(b/a)},smod:function(b,a){return b-a*Math.round(b/a)},sgn:function(a){return !a?0:a>0?1:-1},sgnnz:function(a){return a>=0?1:-1},inScope:function(b,a){return function(){return b.apply(a,arguments)}},byField:function(a){return function(b){return JW.get(b,a)}},byValue:function(b,a){return function(c){return JW.get(c,b)===a}},byMethod:function(b,a){a=a||[];return function(c){return c[b].apply(c,a)}},makeArray:function(a){return JW.isArray(a)?a:JW.isSet(a)?[a]:[]}});JW.toArray=JW.args;JW.ClassUtil={_iid:0,_fnTest:/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,extend:function(e,c,a){a=a||{};var d=function(){};d.prototype=c.prototype;e.prototype=new d();e.prototype.constructor=e;e.superclass=c.prototype;e._super=c;for(var b in a){e.prototype[b]=JW.ClassUtil.extendMethod(a[b],c.prototype[b])}e.extend=function(g){var h=function(){e.apply(this,arguments)};JW.extend(h,e,g);return h};return e},extendMethod:function(b,a){if((typeof a!=="function")||(typeof b!=="function")||b.superclass||!JW.ClassUtil._fnTest.test(b)){return b}return function(){var d=this._super;this._super=a;var c=b.apply(this,arguments);this._super=d;return c}}};JW.extend=JW.ClassUtil.extend;JW.Class=function(){this._iid=++JW.ClassUtil._iid;this._ownagePool=[];this._super=null};JW.extend(JW.Class,Object,{own:function(a){this._ownagePool.push(a);return a},destroy:function(){var b=this._ownagePool;this._ownagePool=[];for(var a=b.length-1;a>=0;--a){b[a].destroy()}}});JW.Event=function(){JW.Event._super.call(this);this.attachments={}};JW.extend(JW.Event,JW.Class,{destroy:function(){this.purge();this._super()},bind:function(c,a){var b=new JW.EventAttachment(this,c,a);this.attachments[b._iid]=b;return b},unbind:function(a){delete this.attachments[a._iid]},purge:function(){this.attachments={}},trigger:function(c){for(var a in this.attachments){var b=this.attachments[a];b.callback.call(b.scope||b,c)}}});JW.EventAttachment=function(b,c,a){JW.EventAttachment._super.call(this);this.event=b;this.callback=c;this.scope=a};JW.extend(JW.EventAttachment,JW.Class,{destroy:function(){this.event.unbind(this)}});JW.EventParams=function(a){JW.EventParams._super.call(this);this.sender=a};JW.extend(JW.EventParams,JW.Class,{});JW.ItemEventParams=function(a,b){JW.ItemEventParams._super.call(this,a);this.item=b};JW.extend(JW.ItemEventParams,JW.EventParams,{});JW.ValueEventParams=function(a,b){JW.ValueEventParams._super.call(this,a);this.value=b};JW.extend(JW.ValueEventParams,JW.EventParams,{});JW.ValueChangeEventParams=function(b,c,a){JW.ValueChangeEventParams._super.call(this,b,c);this.oldValue=a};JW.extend(JW.ValueChangeEventParams,JW.ValueEventParams,{});JW.ItemValueEventParams=function(a,b,c){JW.ItemValueEventParams._super.call(this,a,c);this.item=b};JW.extend(JW.ItemValueEventParams,JW.ValueEventParams,{});JW.AbstractCollection=function(){JW.AbstractCollection._super.call(this);this._ownsItems=false};JW.AbstractCollection._create$Array=function(a){return function(){return new JW.Array(this[a].apply(this,arguments),true)}};JW.AbstractCollection._create$Map=function(a){return function(){return new JW.Map(this[a].apply(this,arguments),true)}};JW.AbstractCollection._create$Set=function(a){return function(){return new JW.Set(this[a].apply(this,arguments),true)}};JW.extend(JW.AbstractCollection,JW.Class,{ownItems:function(){this._ownsItems=true;return this},destroy:function(){this.tryClear();this._super()},getFirst:function(){return this._callStatic("getFirst")},some:function(b,a){return !this.every(function(c){return b.call(this,c)===false},a)},each:function(b,a){this.every(function(c){b.call(this,c);return true},a)},search:function(c,b){var a;this.every(function(d){if(c.call(this,d)!==false){a=d;return false}return true},b);return a},toSorted:function(c,b,a){return this._callStatic("toSorted",[c,b||this,a])},$toSorted:JW.AbstractCollection._create$Array("toSorted"),toSortedComparing:function(c,b,a){return this._callStatic("toSortedComparing",[c,b||this,a])},$toSortedComparing:JW.AbstractCollection._create$Array("toSortedComparing"),index:function(c,b){var a={};this.every(function(e){var d=c.call(this,e);if(JW.isSet(d)){a[d]=e}return true},b);return a},$index:JW.AbstractCollection._create$Map("index"),toArray:function(){var a=new Array(this.getLength());
var b=0;this.every(function(c){a[b++]=c});return a},$toArray:JW.AbstractCollection._create$Array("toArray"),toSet:function(){var a={};this.every(function(b){JW.Set.add(a,b)});return a},$toSet:JW.AbstractCollection._create$Set("toSet"),asArray:function(){return this.toArray()},$asArray:JW.AbstractCollection._create$Array("asArray"),asSet:function(){return this.toSet()},$asSet:JW.AbstractCollection._create$Set("asSet")});JW.AbstractCollection.Counter=function(b,a){JW.AbstractCollection.Counter._super.call(this);a=a||{};this.source=b;this.filterItem=a.filterItem;this.target=a.target||this.own(new JW.Property(0));this.scope=a.scope||this;this.target.set(b.count(this.filterItem,this.scope))};JW.extend(JW.AbstractCollection.Counter,JW.Class,{destroy:function(){this.target.set(0);this._super()},reconfigure:function(a){this.filterItem=JW.def(a.filterItem,this.filterItem);this.scope=JW.def(a.scope,this.scope);this.recount()},recount:function(){this.target.set(this.source.count(this.filterItem,this.scope))}});JW.AbstractCollection.Filterer=function(b,a){JW.AbstractCollection.Filterer._super.call(this);a=a||{};this.source=b;this.filterItem=a.filterItem;this.target=a.target||this.own(this.source.createEmpty());this.scope=a.scope||this};JW.extend(JW.AbstractCollection.Filterer,JW.Class,{});JW.AbstractCollection.Lister=function(b,a){JW.AbstractCollection.Lister._super.call(this);a=a||{};this.source=b;this.target=a.target||this.own(b.createEmptySet());this.target.tryAddAll(b.asArray())};JW.extend(JW.AbstractCollection.Lister,JW.Class,{destroy:function(){this.target.tryRemoveAll(this.source.asArray());this._super()}});JW.AbstractCollection.Indexer=function(b,a){JW.AbstractCollection.Indexer._super.call(this);a=a||{};this.source=b;this.getKey=a.getKey;this.target=a.target||this.own(b.createEmptyMap());this.scope=a.scope||this;this.target.trySetAll(this._index(b.asArray()))};JW.extend(JW.AbstractCollection.Indexer,JW.Class,{destroy:function(){this.target.tryRemoveAll(this._keys(this.source.asArray()));this._super()},_index:function(b){var c={};for(var d=0,a=b.length;d<a;++d){var e=b[d];c[this.getKey.call(this.scope,e)]=e}return c},_keys:function(b){var d=[];for(var c=0,a=b.length;c<a;++c){d.push(this.getKey.call(this.scope,b[c]))}return d}});JW.AbstractCollection.Mapper=function(b,a){JW.AbstractCollection.Mapper._super.call(this);a=a||{};this.source=b;this.createItem=a.createItem;this.destroyItem=a.destroyItem;this.target=a.target||this.own(this.source.createEmpty());this.scope=a.scope||this};JW.extend(JW.AbstractCollection.Mapper,JW.Class,{});JW.AbstractCollection.Observer=function(b,a){JW.AbstractCollection.Observer._super.call(this);a=a||{};this.source=b;this.addItem=a.addItem;this.removeItem=a.removeItem;this.clearItems=a.clearItems;this.change=a.change;this.scope=a.scope||this;this._addItems(b.asArray())};JW.extend(JW.AbstractCollection.Observer,JW.Class,{destroy:function(){this._clearItems(this.source.asArray());this._super()},_addItems:function(b){if(!this.addItem){return}for(var c=0,a=b.length;c<a;++c){this.addItem.call(this.scope,b[c])}},_removeItems:function(a){if(!this.removeItem){return}for(var b=a.length-1;b>=0;--b){this.removeItem.call(this.scope,a[b])}},_clearItems:function(a){if(a.length===0){return}if(this.clearItems){this.clearItems.call(this.scope,a)}else{this._removeItems(a)}},_onChange:function(){this.change.call(this.scope)}});JW.AbstractCollection.Orderer=function(b,a){JW.AbstractCollection.Orderer._super.call(this);a=a||{};this.source=b;this.target=a.target||this.own(b.createEmptyArray());this.target.tryAddAll(b.asArray())};JW.extend(JW.AbstractCollection.Orderer,JW.Class,{destroy:function(){this.target.removeItems(this.source.asArray());this._super()},_splice:function(c,a){var d=this.target.filter(function(e){return !JW.Set.contains(c,e)||JW.Set.contains(a,e)},this);var b=JW.Set.$toArray(a).filter(function(e){return !JW.Set.contains(c,e)},this);this.target.trySplice(this.target.detectFilter(d)||[],[new JW.AbstractArray.IndexItems(d.length,b)])}});JW.AbstractCollection.SorterComparing=function(d,a){JW.AbstractCollection.SorterComparing._super.call(this);a=a||{};this.source=d;this.compare=a.compare||JW.cmp;this.scope=a.scope||this;var b=this.scope;var c=this.compare;this.target=a.target||this.own(d.createEmptyArray());this._splice([],d.asArray())};JW.extend(JW.AbstractCollection.SorterComparing,JW.Class,{destroy:function(){this._splice(this.source.asArray(),[]);this._super()},resort:function(){this.target.sortComparing(this.compare,this.scope)},_splice:function(u,d){var b=JW.Array.toSortedComparing(u,this.compare,this.scope);var a=JW.Array.toSortedComparing(d,this.compare,this.scope);u=new Array(u.length);d=new Array(d.length);var r=0;var i=0;var f=0;var k=0;while((r<b.length)||(i<a.length)){var l=b[r];var e=a[i];var s=JW.cmp(l===undefined,e===undefined)||this.compare.call(this.scope,l,e);if(s<0){u[f++]=l;++r}else{if(s>0){d[k++]=e;++i}else{++r;++i}}}u.splice(f,u.length-f);d.splice(k,d.length-k);var h=0;var q=0;var g=[];var m=[];var p=null;for(var n=0,t=this.target.getLength();n<t;++n){var o=this.target.get(n);if(u[JW.Array.binarySearch(u,o,this.compare,this.scope)-1]===o){if(!p){p=new JW.AbstractArray.IndexCount(n,0);g.push(p)}++p.count;--q}else{p=null;var j=new JW.AbstractArray.IndexItems(n+q,[]);while((h<d.length)&&(this.compare.call(this.scope,d[h],o)<0)){j.items.push(d[h++]);++q}if(j.items.length!==0){m.push(j)}}}if(h<d.length){m.push(new JW.AbstractArray.IndexItems(n+q,d.slice(h)))}this.target.trySplice(g,m)}});JW.AbstractCollection._createStatic$Array=function(b,a){return function(){return new JW.Array(b[a].apply(b,arguments),true)}};JW.AbstractCollection._createStatic$Map=function(b,a){return function(){return new JW.Map(b[a].apply(b,arguments),true)}};JW.AbstractCollection._createStatic$Set=function(b,a){return function(){return new JW.Set(b[a].apply(b,arguments),true)}};JW.AbstractCollection.createStaticMethods=function(a){a.some=function(c,d,b){return !a.every(c,function(e){return d.call(this,e)===false},b)};a.each=function(c,d,b){a.every(c,function(e){d.call(this,e);return true},b)};a.search=function(d,e,c){var b;a.every(d,function(f){if(e.call(this,f)!==false){b=f;return false}return true},c);return b};a.toSorted=function(e,f,c,b){f=f||function(g){return g};b=b||1;var d=[];a.every(e,function(g){d.push([g,f.call(this,g)])},c);d.sort(function(g,h){return b*JW.cmp(g[1],h[1])});return JW.Array.map(d,function(g){return g[0]})};a.$toSorted=JW.AbstractCollection._createStatic$Array(a,"toSorted");a.toSortedComparing=function(f,e,d,b){e=e||JW.cmp;d=d||f;b=b||1;var c=a.toArray(f);c.sort(function(g,h){return b*e.call(d,g,h)});return c};a.$toSortedComparing=JW.AbstractCollection._createStatic$Array(a,"toSortedComparing");a.index=function(d,e,c){var b={};a.every(d,function(g){var f=e.call(this,g);if(JW.isSet(f)){b[f]=g}return true},c);return b};a.$index=JW.AbstractCollection._createStatic$Map(a,"index");a.toArray=function(d){var b=new Array(a.getLength(d));var c=0;a.every(d,function(e){b[c++]=e});return b};a.$toArray=JW.AbstractCollection._createStatic$Array(a,"toArray");a.toSet=function(c){var b={};a.every(c,function(d){JW.Set.add(b,d)});return b};a.$toSet=JW.AbstractCollection._createStatic$Set(a,"toSet");a.asArray=function(b){return a.toArray(b)};a.$asArray=JW.AbstractCollection._createStatic$Array(a,"asArray");a.asSet=function(b){return a.toSet(b)};a.$asSet=JW.AbstractCollection._createStatic$Set(a,"asSet")};JW.IndexedCollection=function(){JW.IndexedCollection._super.call(this)};JW.extend(JW.IndexedCollection,JW.AbstractCollection,{getFirstKey:function(){return this._callStatic("getFirstKey")},$getKeys:JW.AbstractCollection._create$Array("getKeys"),containsKey:function(a){return this.get(a)!==undefined},containsItem:function(a){return !this.every(function(b){return a!==b})},keyOf:function(a){return this.find(function(b){return a===b})},set:function(c,b){var a=this.trySet(c,b);return(a!==undefined)?a.value:this.get(b)},remove:function(a){return this.tryRemove(a)
},removeItem:function(b){var a=this.keyOf(b);if(a!==undefined){this.tryRemove(a)}return a},some:function(b,a){return !this.every(function(d,c){return b.call(this,d,c)===false},a)},each:function(b,a){this.every(function(d,c){b.call(this,d,c);return true},a)},find:function(c,b){var a;this.every(function(e,d){if(c.call(this,e,d)!==false){a=d;return false}return true},b);return a},search:function(c,b){var a;this.every(function(e,d){if(c.call(this,e,d)!==false){a=e;return false}return true},b);return a},getSortingKeys:function(c,b,a){return this._callStatic("getSortingKeys",[c,b||this,a])},$getSortingKeys:JW.AbstractCollection._create$Array("getSortingKeys"),getSortingKeysComparing:function(c,b,a){return this._callStatic("getSortingKeysComparing",[c,b||this,a])},$getSortingKeysComparing:JW.AbstractCollection._create$Array("getSortingKeysComparing"),index:function(c,b){var a={};this.every(function(f,d){var e=c.call(this,f,d);if(JW.isSet(e)){a[e]=f}return true},b);return a},toMap:function(){var a={};this.every(function(c,b){a[b]=c});return a},$toMap:JW.AbstractCollection._create$Map("toMap"),asMap:function(){return this.toMap()},$asMap:JW.AbstractCollection._create$Map("asMap")});JW.IndexedCollection.createStaticMethods=function(a){JW.AbstractCollection.createStaticMethods(a);a.getFirst=function(c){var b=a.getFirstKey(c);if(b!==undefined){return a.get(c,b)}};a.$getKeys=JW.AbstractCollection._createStatic$Array(a,"getKeys");a.containsKey=function(c,b){return a.get(c,b)!==undefined};a.containsItem=function(c,b){return !a.every(c,function(d){return b!==d})};a.keyOf=function(c,b){return a.find(c,function(d){return b===d})};a.set=function(e,d,c){var b=a.trySet(e,d,c);return(b!==undefined)?b.value:a.get(e,c)};a.remove=function(c,b){return a.tryRemove(c,b)};a.removeItem=function(d,c){var b=a.keyOf(d,c);if(b!==undefined){a.tryRemove(d,b)}return b};a.some=function(c,d,b){return !a.every(c,function(f,e){return d.call(this,f,e)===false},b)};a.each=function(c,d,b){a.every(c,function(f,e){d.call(this,f,e);return true},b)};a.find=function(d,e,c){var b;a.every(d,function(g,f){if(e.call(this,g,f)!==false){b=f;return false}return true},c);return b};a.search=function(d,e,c){var b;a.every(d,function(g,f){if(e.call(this,g,f)!==false){b=g;return false}return true},c);return b};a.getSortingKeys=function(e,f,c,b){f=f||function(g){return g};b=b||1;var d=[];a.every(e,function(h,g){d.push([g,f.call(this,h,g)])},c);d.sort(function(g,h){return b*JW.cmp(g[1],h[1])});return JW.Array.map(d,function(g){return g[0]})};a.$getSortingKeys=JW.AbstractCollection._createStatic$Array(a,"getSortingKeys");a.getSortingKeysComparing=function(f,e,c,b){e=e||JW.cmp;b=b||1;var d=[];a.every(f,function(h,g){d.push([g,h])},c);d.sort(function(g,h){return b*e(g[1],h[1],g[0],h[0])});return JW.Array.map(d,function(g){return g[0]})};a.$getSortingKeysComparing=JW.AbstractCollection._createStatic$Array(a,"getSortingKeysComparing");a.toSorted=function(d,e,c,b){return JW.Array.map(a.getSortingKeys(d,e,c,b),function(f){return a.get(d,f)})};a.$toSorted=JW.AbstractCollection._createStatic$Array(a,"toSorted");a.toSortedComparing=function(e,d,c,b){return JW.Array.map(a.getSortingKeysComparing(e,d,c,b),function(f){return a.get(e,f)})};a.$toSortedComparing=JW.AbstractCollection._createStatic$Array(a,"toSortedComparing");a.index=function(d,e,c){var b={};a.every(d,function(h,f){var g=e.call(this,h,f);if(JW.isSet(g)){b[g]=h}return true},c);return b};a.toMap=function(c){var b={};a.every(c,function(e,d){b[d]=e});return b};a.$toMap=JW.AbstractCollection._createStatic$Map(a,"toMap");a.asMap=function(b){return a.toMap(b)};a.$asMap=JW.AbstractCollection._createStatic$Map(a,"asMap")};JW.AbstractArray=function(b,a){JW.AbstractArray._super.call(this);this.items=a?b:b?b.concat():[];this.getKey=null};JW.extend(JW.AbstractArray,JW.IndexedCollection,{getItems:function(){return this.items},getLast:function(){return this.items[this.items.length-1]},getLastKey:function(){var a=this.items.length;if(a!==0){return a-1}},getLength:function(){return this.items.length},isEmpty:function(){return this.items.length===0},get:function(a){return this.items[a]},getKeys:function(){var c=this.items;var a=new Array(c.length);for(var d=0,b=c.length;d<b;++d){a[d]=d}return a},every:function(b,a){return JW.Array.every(this.items,b,a||this)},filter:function(b,a){return JW.Array.filter(this.items,b,a||this)},$filter:JW.AbstractCollection._create$Array("filter"),count:function(b,a){return JW.Array.count(this.items,b,a||this)},map:function(b,a){return JW.Array.map(this.items,b,a||this)},$map:JW.AbstractCollection._create$Array("map"),toArray:function(){return this.items.concat()},asArray:function(){return this.items},$asArray:function(){return this},add:function(b,a){this.tryAdd(b,a)},tryAdd:function(b,a){return this.tryAddAll([b],a)},addAll:function(a,b){this.tryAddAll(a,b)},tryAddAll:function(a,b){if(b===undefined){b=this.items.length}if(this.trySplice([],[new JW.AbstractArray.IndexItems(b,a)])){return true}},trySet:function(c,b){var a=JW.Array.trySet(this.items,c,b);if((a!==undefined)&&this._ownsItems){a.get().destroy()}return a},tryRemove:function(b){var a=this.tryRemoveAll(b,1);if(a!==undefined){return a[0]}},removeAll:function(b,c){var a=this.tryRemoveAll(b,c);return a||[]},$removeAll:JW.AbstractCollection._create$Array("removeAll"),tryRemoveAll:function(b,c){var a=this.trySplice([new JW.AbstractArray.IndexCount(b,c)],[]);if(a!==undefined){return a.removedItemsList[0].items}},removeItems:function(a){var c=new JW.Set(a);var b=this.filter(function(d){return !c.contains(d)});this.performFilter(b)},move:function(a,b){this.tryMove(a,b);return this.get(b)},tryMove:function(a,b){return JW.Array.tryMove(this.items,a,b)},clear:function(){var a=this.tryClear();return(a!==undefined)?a:[]},$clear:JW.AbstractCollection._create$Array("clear"),tryClear:function(){var a=JW.Array.tryClear(this.items);if((a!==undefined)&&this._ownsItems){JW.Array.backEvery(a,JW.destroy)}return a},splice:function(c,b){var a=this.trySplice(c,b);return(a!==undefined)?a:new JW.AbstractArray.SpliceResult(this.items.concat(),[],[])},trySplice:function(c,a){var b=JW.Array.trySplice(this.items,c,a);if((b!==undefined)&&this._ownsItems){JW.Array.backEvery(b.getRemovedItems(),JW.destroy)}return b},reorder:function(a){this.tryReorder(a)},tryReorder:function(a){return JW.Array.tryReorder(this.items,a)},detectSplice:function(b,a,c){return JW.Array.detectSplice(this.items,b,a||this.getKey,c||this)},detectFilter:function(a){return JW.Array.detectFilter(this.items,a)},detectReorder:function(b,a,c){return JW.Array.detectReorder(this.items,b,a||this.getKey,c||this)},detectSort:function(c,b,a){return JW.Array.detectSort(this.items,c,b||this,a)},detectSortComparing:function(c,b,a){return JW.Array.detectSortComparing(this.items,c,b||this,a)},performSplice:function(b,a,c){var d=this.detectSplice(b,a||this.getKey,c||this);if(d!==undefined){this.trySplice(d.removeParamsList,d.addParamsList)}},performFilter:function(a){var b=this.detectFilter(a);if(b!==undefined){this.trySplice(b,[])}},performReorder:function(c,b,d){var a=this.detectReorder(c,b||this.getKey,d||this);if(a!==undefined){this.tryReorder(a)}},sort:function(d,c,a){var b=this.detectSort(d,c,a);if(b!==undefined){this.tryReorder(b)}},sortComparing:function(d,c,a){var b=this.detectSortComparing(d,c,a);if(b!==undefined){this.tryReorder(b)}},createMapper:function(a){return new JW.AbstractArray.Mapper(this,a)},createFilterer:function(a){return new JW.AbstractArray.Filterer(this,a)},createCounter:function(a){return new JW.AbstractArray.Counter(this,a)},createObserver:function(a){return new JW.AbstractArray.Observer(this,a)},createOrderer:function(a){return new JW.AbstractArray.Orderer(this,a)},createSorterComparing:function(a){return new JW.AbstractArray.SorterComparing(this,a)},createIndexer:function(a){return new JW.AbstractArray.Indexer(this,a)},createLister:function(a){return new JW.AbstractArray.Lister(this,a)},createInserter:function(a){return new JW.AbstractArray.Inserter(this,a)
},createMerger:function(a){return new JW.AbstractArray.Merger(this,a)},createMergerBunch:function(a){return new JW.AbstractArray.Merger.Bunch(a,this)},createReverser:function(a){return new JW.AbstractArray.Reverser(this,a)},createSplitter:function(a){return new JW.AbstractArray.Splitter(this,a)},equal:function(a){return JW.Array.equal(this.items,a)},collapse:function(a){return JW.Array.collapse(this.items,a)},indexOf:function(a){return JW.Array.indexOf(this.items,a)},backEvery:function(b,a){return JW.Array.backEvery(this.items,b,a)},top:function(){return JW.Array.top(this.items)},pop:function(){if(this.items.length!==0){return this.tryRemove(this.items.length-1)}},binarySearch:function(c,b,a){return JW.Array.binarySearch(this.items,c,b,a)},_callStatic:function(a,b){return JW.Array[a].apply(JW.Array,[this.items].concat(b||[]))}});JW.AbstractArray.IndexCount=function(a,b){JW.AbstractArray.IndexCount._super.call(this);this.index=a;this.count=b};JW.extend(JW.AbstractArray.IndexCount,JW.Class,{clone:function(){return new JW.AbstractArray.IndexCount(this.index,this.count)}});JW.AbstractArray.IndexItems=function(b,a){JW.AbstractArray.IndexItems._super.call(this);this.index=b;this.items=a};JW.extend(JW.AbstractArray.IndexItems,JW.Class,{toIndexCount:function(){return new JW.AbstractArray.IndexCount(this.index,this.items.length)},clone:function(){return new JW.AbstractArray.IndexItems(this.index,this.items.concat())}});JW.AbstractArray.SpliceParams=function(b,a){JW.AbstractArray.SpliceParams._super.call(this);this.removeParamsList=b;this.addParamsList=a};JW.extend(JW.AbstractArray.SpliceParams,JW.Class,{});JW.AbstractArray.SpliceResult=function(b,c,a){JW.AbstractArray.SpliceResult._super.call(this);this.oldItems=b;this.removedItemsList=c;this.addedItemsList=a;this.removedItems=null;this.addedItems=null;this.removeParamsList=null};JW.extend(JW.AbstractArray.SpliceResult,JW.Class,{getRemovedItems:function(){if(!this.removedItems){this.removedItems=JW.Array.merge(JW.Array.map(this.removedItemsList,JW.byField("items")))}return this.removedItems},getAddedItems:function(){if(!this.addedItems){this.addedItems=JW.Array.merge(JW.Array.map(this.addedItemsList,JW.byField("items")))}return this.addedItems},getRemoveParamsList:function(){if(!this.removeParamsList){this.removeParamsList=JW.Array.map(this.removedItemsList,JW.byMethod("toIndexCount"))}return this.removeParamsList},isEmpty:function(){return(this.removedItemsList.length===0)&&(this.addedItemsList.length===0)}});JW.AbstractArray.Counter=function(b,a){JW.AbstractArray.Counter._super.call(this,b,a)};JW.extend(JW.AbstractArray.Counter,JW.AbstractCollection.Counter,{});JW.AbstractArray.Filterer=function(b,a){JW.AbstractArray.Filterer._super.call(this,b,a);this._filtered=[];this._splice([],[new JW.AbstractArray.IndexItems(0,this.source.getItems())])};JW.extend(JW.AbstractArray.Filterer,JW.AbstractCollection.Filterer,{destroy:function(){this.target.tryClear();this._super()},_countFiltered:function(b,d){var a=0;for(var c=0;c<d;++c){a+=this._filtered[b+c]}return a},_splice:function(f,c){var a=0;var b=0;var e=JW.Array.map(f,function(h){b+=this._countFiltered(a,h.index-a);var g=this._countFiltered(h.index,h.items.length);var i=new JW.AbstractArray.IndexCount(b,g);a=h.index+h.items.length;b+=g;return i},this);JW.Array.trySplice(this._filtered,JW.Array.map(f,JW.byMethod("toIndexCount")),[]);var a=0;var b=0;var d=JW.Array.map(c,function(i){b+=this._countFiltered(a,i.index-a);var g=[];var h=JW.Array.map(i.items,function(k){if(this.filterItem.call(this.scope,k)===false){return 0}g.push(k);return 1},this);var j=new JW.AbstractArray.IndexItems(b,g);JW.Array.tryAddAll(this._filtered,h,i.index);a=i.index+h.length;b+=g.length;return j},this);this.target.trySplice(e,d)},reconfigure:function(a){this.filterItem=JW.def(a.filterItem,this.filterItem);this.scope=JW.def(a.scope,this.scope);this.refilter()},refilterAt:function(a){var d=this.source.get(a);var c=this.filterItem.call(this.scope,d)!==false;var b=this._countFiltered(0,a);if(this._filtered[a]===0){if(c){this._filtered[a]=1;this.target.add(d,b)}}else{if(!c){this._filtered[a]=0;this.target.remove(b)}}},refilterItem:function(b){var a=this.source.indexOf(b);if(a!==-1){this.refilterAt(a)}},refilter:function(){var g=this.source.map(function(i){return(this.filterItem.call(this.scope,i)!==false)?1:0},this);var a=null;var h=[];function c(){if(a!==null){h.push(a);a=null}}var b=0;this.source.every(function(j,i){if(this._filtered[i]===0){return}if(g[i]===0){if(a===null){a=new JW.AbstractArray.IndexCount(b,0)}++a.count;this._filtered[i]=0}else{c()}++b},this);c();var f=null;var d=[];function e(){if(f!==null){d.push(f);f=null}}var b=0;this.source.every(function(j,i){if(this._filtered[i]===1){e();++b;return}if(g[i]===1){if(f===null){f=new JW.AbstractArray.IndexItems(b,[])}f.items.push(j);this._filtered[i]=1;++b}else{e()}},this);e();this._filtered=g;this.target.trySplice(h,d)}});JW.AbstractArray.Indexer=function(b,a){JW.AbstractArray.Indexer._super.call(this,b,a)};JW.extend(JW.AbstractArray.Indexer,JW.AbstractCollection.Indexer,{});JW.AbstractArray.Inserter=function(b,a){JW.AbstractArray.Inserter._super.call(this);a=a||{};this.source=b;this.addItem=a.addItem;this.removeItem=a.removeItem;this.clearItems=a.clearItems;this.scope=a.scope||this;this._addItems(this.source.getItems(),0)};JW.extend(JW.AbstractArray.Inserter,JW.Class,{destroy:function(){this._clearItems(this.source.getItems());this._super()},_addItems:function(a,b){if(!this.addItem){return}for(var c=0;c<a.length;++c){this.addItem.call(this.scope,a[c],c+b)}},_removeItems:function(a,b){if(!this.removeItem){return}for(var c=a.length-1;c>=0;--c){this.removeItem.call(this.scope,a[c],c+b)}},_clearItems:function(a){if(a.length===0){return}if(this.clearItems){this.clearItems.call(this.scope||this,a)}else{this._removeItems(a,0)}}});JW.AbstractArray.Lister=function(b,a){JW.AbstractArray.Lister._super.call(this,b,a)};JW.extend(JW.AbstractArray.Lister,JW.AbstractCollection.Lister,{});JW.AbstractArray.Mapper=function(b,a){JW.AbstractArray.Mapper._super.call(this,b,a);this.target.tryAddAll(this._createItems(this.source.getItems()))};JW.extend(JW.AbstractArray.Mapper,JW.AbstractCollection.Mapper,{destroy:function(){this._destroyItems(this.target.clear(),this.source.getItems());this._super()},_createItems:function(a){var c=[];for(var d=0,b=a.length;d<b;++d){c.push(this.createItem.call(this.scope,a[d]))}return c},_destroyItems:function(b,a){if(this.destroyItem===undefined){return}for(var c=b.length-1;c>=0;--c){this.destroyItem.call(this.scope,b[c],a[c])}}});JW.AbstractArray.Merger=function(b,a){JW.AbstractArray.Merger._super.call(this);a=a||{};this.source=b;this.target=a.target||this.own(this._createTarget());this.own(b.createMapper({createItem:function(c){return c.createMergerBunch(this)},destroyItem:JW.destroy,scope:this}));this.target.tryAddAll(this._getAllItems())};JW.extend(JW.AbstractArray.Merger,JW.Class,{destroy:function(){this.target.tryClear();this._super()},_createTarget:function(){return this.source.some(function(a){return a instanceof JW.ObservableArray},this)?new JW.ObservableArray():new JW.Array()},_getAllItems:function(){return this._merge(this.source.getItems())},_merge:function(h){var d=new Array(this._count(h));var g=0;for(var f=0,c=h.length;f<c;++f){var b=h[f].getItems();for(var e=0,a=b.length;e<a;++e){d[g++]=b[e]}}return d},_count:function(e,a,d){if(a===undefined){a=0}if(d===undefined){d=e.length-a}var c=0;for(var b=0;b<d;++b){c+=e[a+b].getLength()}return c}});JW.AbstractArray.Merger.Bunch=function(b,a){JW.AbstractArray.Merger.Bunch._super.call(this)};JW.extend(JW.AbstractArray.Merger.Bunch,JW.Class);JW.AbstractArray.Observer=function(b,a){JW.AbstractArray.Observer._super.call(this,b,a)};JW.extend(JW.AbstractArray.Observer,JW.AbstractCollection.Observer,{});JW.AbstractArray.Orderer=function(b,a){JW.AbstractArray.Orderer._super.call(this,b,a)};JW.extend(JW.AbstractArray.Orderer,JW.AbstractCollection.Orderer,{});JW.AbstractArray.Reverser=function(b,a){JW.AbstractArray.Reverser._super.call(this);
a=a||{};this.source=b;this.target=a.target||this.own(b.createEmpty());this.target.tryAddAll(this._reverse(b.getItems()))};JW.extend(JW.AbstractArray.Reverser,JW.Class,{destroy:function(){this.target.tryClear();this._super()},_reverse:function(a){a=a.concat();a.reverse();return a}});JW.AbstractArray.SorterComparing=function(b,a){JW.AbstractArray.SorterComparing._super.call(this,b,a)};JW.extend(JW.AbstractArray.SorterComparing,JW.AbstractCollection.SorterComparing,{});JW.AbstractArray.Splitter=function(b,a){JW.AbstractArray.Splitter._super.call(this);a=a||{};this.source=b;this.rows=a.rows||this.own(this.source.createEmpty());this.capacity=a.capacity||1;this._length=0;this.own(this.source.createInserter({addItem:this._addItem,removeItem:this._removeItem,clearItems:this._clearItems,scope:this}))};JW.extend(JW.AbstractArray.Splitter,JW.Class,{createRow:function(){return this.source.createEmpty()},destroyRow:function(a){a.destroy()},_addItem:function(d,b){if(this._length%this.capacity===0){this.rows.tryAdd(this.createRow.call(this.scope||this))}var e=Math.floor(b/this.capacity);for(var c=this.rows.getLength()-1;c>e;--c){var a=this.rows.get(c-1).tryRemove(this.capacity-1);this.rows.get(c).tryAdd(a,0)}this.rows.get(e).tryAdd(d,b%this.capacity);++this._length},_removeItem:function(d,b){var e=Math.floor(b/this.capacity);this.rows.get(e).tryRemove(b%this.capacity);for(var c=e+1;c<this.rows.getLength();++c){var a=this.rows.get(c).tryRemove(0);this.rows.get(c-1).tryAdd(a,this.capacity-1)}--this._length;if(this._length%this.capacity===0){this.destroyRow.call(this.scope||this,this.rows.tryRemove(this.rows.getLength()-1))}},_clearItems:function(){var a=this.rows.tryClear();this._length=0;JW.Array.each(a,this.destroyRow,this.scope||this)}});JW.AbstractMap=function(b,a){JW.AbstractMap._super.call(this);this.json=a?b:b?JW.apply({},b):{};this._length=JW.Map.getLength(this.json);this.getKey=null};JW.extend(JW.AbstractMap,JW.IndexedCollection,{getJson:function(){return this.json},getLength:function(){return this._length},isEmpty:function(){return this._length===0},get:function(a){return this.json[a]},getKeys:function(){return JW.Map.getKeys(this.json)},every:function(b,a){return JW.Map.every(this.json,b,a)},filter:function(b,a){return JW.Map.filter(this.json,b,a)},$filter:JW.AbstractCollection._create$Map("filter"),count:function(b,a){return JW.Map.count(this.json,b,a)},map:function(b,a){return JW.Map.map(this.json,b,a)},$map:JW.AbstractCollection._create$Map("map"),asMap:function(){return this.json},$asMap:function(){return this},trySet:function(b,a){var c=this.trySplice([],JW.Map.single(a,b));if(c!==undefined){return new JW.Proxy(c.removedItems[a])}},setAll:function(a){var b=this.trySetAll(a);return(b!==undefined)?b:new JW.AbstractMap.SpliceResult({},{})},trySetAll:function(a){return this.trySplice([],a)},setKey:function(a,b){this.trySetKey(a,b);return this.json[b]},trySetKey:function(a,b){var c=this.tryReindex(JW.Map.single(a,b));if(c!==undefined){return this.json[b]}},tryRemove:function(a){var b=this.trySplice([a],{});if(b!==undefined){return b.removedItems[a]}},removeAll:function(b){var a=this.tryRemoveAll(b);return(a!==undefined)?a:{}},$removeAll:JW.AbstractCollection._create$Map("removeAll"),tryRemoveAll:function(a){var b=this.trySplice(a,{});if(b!==undefined){return b.removedItems}},removeItems:function(a){var c=new JW.Set(a);var b=this.filter(function(d){return !c.contains(d)});this.performSplice(b)},clear:function(){var a=this.tryClear();return(a!==undefined)?a:{}},$clear:JW.AbstractCollection._create$Map("clear"),tryClear:function(){this._length=0;var a=JW.Map.tryClear(this.json);if((a!==undefined)&&this._ownsItems){JW.Array.backEvery(JW.Map.toArray(a),JW.destroy)}return a},splice:function(a,b){var c=this.trySplice(a,b);return(c!==undefined)?c:new JW.AbstractMap.SpliceResult({},{})},trySplice:function(a,b){var c=JW.Map.trySplice(this.json,a,b);if(c!==undefined){this._length+=JW.Map.getLength(c.addedItems)-JW.Map.getLength(c.removedItems);if(this._ownsItems){JW.Array.backEvery(JW.Map.toArray(c.removedItems),JW.destroy)}return c}},reindex:function(b){var a=this.tryReindex(b);return(a!==undefined)?a:{}},tryReindex:function(a){return JW.Map.tryReindex(this.json,a)},detectSplice:function(a){return JW.Map.detectSplice(this.json,a)},detectReindex:function(b,a,c){return JW.Map.detectReindex(this.json,b,a||this.getKey,c||this)},performSplice:function(a){var b=this.detectSplice(a);if(b!==undefined){this.trySplice(b.removedKeys,b.updatedItems)}},performReindex:function(b,a,c){var d=this.detectReindex(b,a,c);if(d!==undefined){this.tryReindex(d)}},createMapper:function(a){return new JW.AbstractMap.Mapper(this,a)},createFilterer:function(a){return new JW.AbstractMap.Filterer(this,a)},createCounter:function(a){return new JW.AbstractMap.Counter(this,a)},createObserver:function(a){return new JW.AbstractMap.Observer(this,a)},createOrderer:function(a){return new JW.AbstractMap.Orderer(this,a)},createSorterComparing:function(a){return new JW.AbstractMap.SorterComparing(this,a)},createIndexer:function(a){return new JW.AbstractMap.Indexer(this,a)},createLister:function(a){return new JW.AbstractMap.Lister(this,a)},createInserter:function(a){return new JW.AbstractMap.Inserter(this,a)},equal:function(a){return JW.Map.equal(this.json,a)},_callStatic:function(a,b){return JW.Map[a].apply(JW.Map,[this.json].concat(JW.args(b||[])))}});JW.AbstractMap.SpliceParams=function(a,b){JW.AbstractMap.SpliceParams._super.call(this);this.removedKeys=a;this.updatedItems=b};JW.extend(JW.AbstractMap.SpliceParams,JW.Class,{});JW.AbstractMap.SpliceResult=function(a,b){JW.AbstractMap.SpliceResult._super.call(this);this.removedItems=a;this.addedItems=b};JW.extend(JW.AbstractMap.SpliceResult,JW.Class,{});JW.AbstractMap.Counter=function(b,a){JW.AbstractMap.Counter._super.call(this,b,a)};JW.extend(JW.AbstractMap.Counter,JW.AbstractCollection.Counter,{});JW.AbstractMap.Filterer=function(b,a){JW.AbstractMap.Filterer._super.call(this,b,a);this.target.trySetAll(b.filter(this.filterItem,this.scope))};JW.extend(JW.AbstractMap.Filterer,JW.AbstractCollection.Filterer,{destroy:function(){this.target.tryRemoveAll(this.source.getKeys());this._super()}});JW.AbstractMap.Indexer=function(b,a){JW.AbstractMap.Indexer._super.call(this,b,a)};JW.extend(JW.AbstractMap.Indexer,JW.AbstractCollection.Indexer,{});JW.AbstractMap.Inserter=function(b,a){JW.AbstractMap.Inserter._super.call(this);a=a||{};this.source=b;this.addItem=a.addItem;this.removeItem=a.removeItem;this.scope=a.scope||this;this.clearItems=a.clearItems;this._addItems(this.source.getJson())};JW.extend(JW.AbstractMap.Inserter,JW.Class,{destroy:function(){this._clearItems(this.source.getJson());this._super()},_addItems:function(a){if(!this.addItem){return}for(var b in a){this.addItem.call(this.scope,a[b],b)}},_removeItems:function(a){if(!this.removeItem){return}for(var b in a){this.removeItem.call(this.scope,b,a[b])}},_clearItems:function(a){if(JW.Map.isEmpty(a)){return}if(this.clearItems){this.clearItems.call(this.scope||this,a)}else{this._removeItems(a)}}});JW.AbstractMap.Lister=function(b,a){JW.AbstractMap.Lister._super.call(this,b,a)};JW.extend(JW.AbstractMap.Lister,JW.AbstractCollection.Lister,{});JW.AbstractMap.Mapper=function(b,a){JW.AbstractMap.Mapper._super.call(this,b,a);this.target.trySetAll(this._createItems(b.getJson()))};JW.extend(JW.AbstractMap.Mapper,JW.AbstractCollection.Mapper,{destroy:function(){this._destroyItems(this.target.removeAll(this.source.getKeys()),this.source.getJson());this._super()},_createItems:function(a){var b={};for(var c in a){b[c]=this.createItem.call(this.scope,a[c])}return b},_destroyItems:function(b,a){if(this.destroyItem===undefined){return}for(var c in b){this.destroyItem.call(this.scope,b[c],a[c])}}});JW.AbstractMap.Observer=function(b,a){JW.AbstractMap.Observer._super.call(this,b,a)};JW.extend(JW.AbstractMap.Observer,JW.AbstractCollection.Observer,{});JW.AbstractMap.Orderer=function(b,a){JW.AbstractMap.Orderer._super.call(this,b,a)
};JW.extend(JW.AbstractMap.Orderer,JW.AbstractCollection.Orderer,{});JW.AbstractMap.SorterComparing=function(b,a){JW.AbstractMap.SorterComparing._super.call(this,b,a)};JW.extend(JW.AbstractMap.SorterComparing,JW.AbstractCollection.SorterComparing,{});JW.AbstractSet=function(b,a){JW.AbstractSet._super.call(this);this.json=a?b:b?JW.Array.index(b,JW.byField("_iid")):{};this._length=JW.Set.getLength(this.json)};JW.extend(JW.AbstractSet,JW.AbstractCollection,{getJson:function(){return this.json},getLength:function(){return this._length},isEmpty:function(){return this._length===0},containsItem:function(a){return this.json.hasOwnProperty(a._iid)},contains:function(a){return this.json.hasOwnProperty(a._iid)},every:function(b,a){return JW.Set.every(this.json,b,a)},filter:function(b,a){return JW.Set.filter(this.json,b,a)},$filter:JW.AbstractCollection._create$Set("filter"),count:function(b,a){return JW.Set.count(this.json,b,a)},map:function(b,a){return JW.Set.map(this.json,b,a)},$map:JW.AbstractCollection._create$Set("map"),asSet:function(){return this.json},$asSet:function(){return this},add:function(a){return this.tryAdd(a)!==undefined},tryAdd:function(a){if(this.trySplice([],[a])!==undefined){return true}},addAll:function(b){var a=this.tryAddAll(b);return(a!==undefined)?a:[]},$addAll:JW.AbstractCollection._create$Array("addAll"),tryAddAll:function(a){var b=this.trySplice([],a);if(b!==undefined){return b.addedItems}},remove:function(a){return this.tryRemove(a)!==undefined},tryRemove:function(a){if(this.trySplice([a],[])!==undefined){return true}},removeItem:function(a){this.tryRemove(a)},removeAll:function(b){var a=this.tryRemoveAll(b);return(a!==undefined)?a:[]},$removeAll:JW.AbstractCollection._create$Array("removeAll"),tryRemoveAll:function(a){var b=this.trySplice(a,[]);if(b!==undefined){return b.removedItems}},removeItems:function(a){this.tryRemoveAll(a)},clear:function(){var a=this.tryClear();return(a!==undefined)?a:[]},$clear:JW.AbstractCollection._create$Array("clear"),tryClear:function(){this._length=0;var a=JW.Set.tryClear(this.json);if((a!==undefined)&&this._ownsItems){JW.Array.backEvery(a,JW.destroy)}return a},splice:function(a,b){var c=this.trySplice(a,b);return(c!==undefined)?c:new JW.AbstractSet.SpliceResult([],[])},trySplice:function(a,b){var c=JW.Set.trySplice(this.json,a,b);if(c!==undefined){this._length+=c.addedItems.length-c.removedItems.length;if(this._ownsItems){JW.Array.backEvery(c.removedItems,JW.destroy)}return c}},detectSplice:function(a){return JW.Set.detectSplice(this.json,a)},performSplice:function(a){var b=this.detectSplice(a);if(b!==undefined){this.trySplice(b.removedItems,b.addedItems)}},createMapper:function(a){return new JW.AbstractSet.Mapper(this,a)},createFilterer:function(a){return new JW.AbstractSet.Filterer(this,a)},createCounter:function(a){return new JW.AbstractSet.Counter(this,a)},createObserver:function(a){return new JW.AbstractSet.Observer(this,a)},createOrderer:function(a){return new JW.AbstractSet.Orderer(this,a)},createSorterComparing:function(a){return new JW.AbstractSet.SorterComparing(this,a)},createIndexer:function(a){return new JW.AbstractSet.Indexer(this,a)},createLister:function(a){return new JW.AbstractSet.Lister(this,a)},equal:function(a){return JW.Set.equal(this.json,a)},_callStatic:function(a,b){return JW.Set[a].apply(JW.Set,[this.json].concat(JW.args(b||[])))}});JW.AbstractSet.SpliceParams=function(a,b){JW.AbstractSet.SpliceParams._super.call(this);this.removedItems=a;this.addedItems=b};JW.extend(JW.AbstractSet.SpliceParams,JW.Class,{});JW.AbstractSet.SpliceResult=function(a,b){JW.AbstractSet.SpliceResult._super.call(this);this.removedItems=a;this.addedItems=b};JW.extend(JW.AbstractSet.SpliceResult,JW.Class,{});JW.AbstractSet.Counter=function(b,a){JW.AbstractSet.Counter._super.call(this,b,a)};JW.extend(JW.AbstractSet.Counter,JW.AbstractCollection.Counter,{});JW.AbstractSet.Filterer=function(b,a){JW.AbstractSet.Filterer._super.call(this,b,a);this.target.tryAddAll(b.$toArray().filter(this.filterItem,this.scope))};JW.extend(JW.AbstractSet.Filterer,JW.AbstractCollection.Filterer,{destroy:function(){this.target.tryRemoveAll(this.source.toArray());this._super()}});JW.AbstractSet.Indexer=function(b,a){JW.AbstractSet.Indexer._super.call(this,b,a)};JW.extend(JW.AbstractSet.Indexer,JW.AbstractCollection.Indexer,{});JW.AbstractSet.Lister=function(b,a){JW.AbstractSet.Lister._super.call(this,b,a)};JW.extend(JW.AbstractSet.Lister,JW.AbstractCollection.Lister,{});JW.AbstractSet.Mapper=function(b,a){JW.AbstractSet.Mapper._super.call(this,b,a);this._items={};this.target.tryAddAll(this._createItems(b.toArray()))};JW.extend(JW.AbstractSet.Mapper,JW.AbstractCollection.Mapper,{destroy:function(){var a=this.source.toArray();this.target.tryRemoveAll(this._getItems(a));this._destroyItems(a);this._super()},_getItems:function(a){return JW.Array.map(a,function(b){return this._items[b._iid]},this)},_createItems:function(a){var c=[];for(var d=0,b=a.length;d<b;++d){var f=a[d];var e=this.createItem.call(this.scope||this,f);c.push(e);this._items[f._iid]=e}return c},_destroyItems:function(a){if(this.destroyItem===undefined){return}for(var b=a.length-1;b>=0;--b){var d=a[b];var e=d._iid;var c=this._items[e];delete this._items[e];this.destroyItem.call(this.scope||this,c,d)}}});JW.AbstractSet.Observer=function(b,a){JW.AbstractSet.Observer._super.call(this,b,a)};JW.extend(JW.AbstractSet.Observer,JW.AbstractCollection.Observer,{});JW.AbstractSet.Orderer=function(b,a){JW.AbstractSet.Orderer._super.call(this,b,a)};JW.extend(JW.AbstractSet.Orderer,JW.AbstractCollection.Orderer,{});JW.AbstractSet.SorterComparing=function(b,a){JW.AbstractSet.SorterComparing._super.call(this,b,a)};JW.extend(JW.AbstractSet.SorterComparing,JW.AbstractCollection.SorterComparing,{});JW.Array=function(b,a){JW.Array._super.call(this,b,a)};JW.extend(JW.Array,JW.AbstractArray,{createEmpty:function(){return new JW.Array()},createEmptyArray:function(){return new JW.Array()},createEmptyMap:function(){return new JW.Map()},createEmptySet:function(){return new JW.Set()}});JW.IndexedCollection.createStaticMethods(JW.Array);JW.apply(JW.Array,{getFirstKey:function(a){if(a.length!==0){return 0}},getLast:function(a){return a[a.length-1]},getLastKey:function(b){var a=b.length;if(a!==0){return a-1}},getLength:function(a){return a.length},isEmpty:function(a){return a.length===0},get:function(b,a){return b[a]},getKeys:function(d){var a=new Array(d.length);for(var c=0,b=d.length;c<b;++c){a[c]=c}return a},every:function(d,e,c){for(var b=0,a=d.length;b<a;++b){if(e.call(c||d,d[b],b)===false){return false}}return true},filter:function(c,d,b){var a=[];JW.Array.every(c,function(f,e){if(d.call(this,f,e)!==false){a.push(f)}},b);return a},$filter:JW.AbstractCollection._createStatic$Array(JW.Array,"filter"),count:function(c,d,b){var a=0;JW.Array.every(c,function(f,e){if(d.call(this,f,e)!==false){++a}},b);return a},map:function(c,d,b){var a=[];JW.Array.every(c,function(f,e){a.push(d.call(this,f,e))},b);return a},$map:JW.AbstractCollection._createStatic$Array(JW.Array,"map"),toArray:function(a){return a.concat()},toSet:function(a){return JW.Array.index(a,JW.iid)},asArray:function(a){return a},add:function(c,b,a){JW.Array.tryAdd(c,b,a)},tryAdd:function(c,b,a){c.splice(JW.def(a,c.length),0,b);return true},addAll:function(c,a,b){JW.Array.tryAddAll(c,a,b)},tryAddAll:function(c,a,b){if(a.length===0){return}if(b===undefined){c.push.apply(c,a)}else{c.splice.apply(c,[b,0].concat(a))}return true},trySet:function(d,b,a){var c=d[a];if(b!==c){d[a]=b;return new JW.Proxy(c)}},tryRemove:function(b,a){return b.splice(a,1)[0]},removeAll:function(d,b,c){var a=JW.Array.tryRemoveAll(d,b,c);return a||[]},$removeAll:JW.AbstractCollection._createStatic$Array(JW.Array,"removeAll"),tryRemoveAll:function(c,a,b){if(b===0){return}return c.splice(a,b)},removeItems:function(d,a){var c=new JW.Set(a);var b=JW.Array.filter(d,function(e){return !c.contains(e)});JW.Array.performSplice(d,b)},move:function(c,a,b){JW.Array.tryMove(c,a,b);
return JW.Array.get(c,b)},tryMove:function(d,a,c){if(a===c){return}var b=d[a];d.splice(a,1);d.splice(c,0,b);return b},clear:function(b){var a=JW.Array.tryClear(b);return(a!==undefined)?a:[]},$clear:JW.AbstractCollection._createStatic$Array(JW.Array,"clear"),tryClear:function(a){if(a.length!==0){return a.splice(0,a.length)}},splice:function(c,d,b){var a=JW.Array.trySplice(c,d,b);return(a!==undefined)?a:new JW.AbstractArray.SpliceResult(c.concat(),[],[])},trySplice:function(g,p,m){var o;var a=[];o=null;for(var e=0,c=p.length;e<c;++e){var d=p[e];if(o&&(d.index===o.index+o.count)){o.count+=d.count}else{o=d.clone();a.push(o)}}var k=[];o=null;for(var e=0,c=m.length;e<c;++e){var d=m[e];if(o&&(d.index===o.index+o.items.length)){JW.Array.tryAddAll(o.items,d.items)}else{o=d.clone();k.push(o)}}var n=g.concat();var j=[];for(var e=a.length-1;e>=0;--e){var d=a[e];var f=d.index;var h=JW.Array.tryRemoveAll(g,f,d.count);if(h===undefined){continue}j.push(new JW.AbstractArray.IndexItems(f,h))}var b=[];for(var e=0,c=k.length;e<c;++e){var d=k[e];if(JW.Array.tryAddAll(g,d.items,d.index)===undefined){continue}b.push(d)}if((j.length!==0)||(b.length!==0)){j.reverse();return new JW.AbstractArray.SpliceResult(n,j,b)}},reorder:function(b,a){JW.Array.tryReorder(b,a)},tryReorder:function(d,a){var c=d.length;if(JW.Array.isIdentity(a)){return}var e=d.concat();for(var b=0;b<c;++b){d[a[b]]=e[b]}return e},detectSplice:function(j,f,h,a){h=h||JW.iid;a=a||j;var e=[];var m=[];var k={};for(var q=0,o=j.length;q<o;++q){k[h.call(a,j[q])]=q}var u=0;var d=0;var r=[];function p(i){r.push(i)}function n(){if(r.length===0){return}m.push(new JW.AbstractArray.IndexItems(d+u,r));d+=r.length;r=[]}function g(l){if(l>u){var i=l-u;e.push(new JW.AbstractArray.IndexCount(u,i));d-=i}}for(var b=0,o=f.length;b<o;++b){var s=f[b];var t=h.call(a,s);var c=k[t];if((c===undefined)||(c<u)){p(s)}else{n();g(c);u=c+1}}n();g(j.length);if((e.length!==0)||(m.length!==0)){return new JW.AbstractArray.SpliceParams(e,m)}},detectFilter:function(f,i){var h=[];var e=0;var a=f.length;var b=i.length;for(var g=0;g<=b;++g){var c=i[g];var d=0;while((e+d<a)&&(f[e+d]!==c)){++d}if(d!==0){h.push(new JW.AbstractArray.IndexCount(e,d))}e+=d+1}if(h.length!==0){return h}},detectReorder:function(g,d,c,f){c=c||JW.iid;f=f||g;var b=[];var h={};for(var e=0,a=d.length;e<a;++e){h[c.call(f,d[e])]=e}for(var e=0,a=g.length;e<a;++e){b.push(h[c.call(f,g[e])])}if(!JW.Array.isIdentity(b)){return b}},detectSort:function(d,e,b,a){var c=JW.Array.getSortingKeys(d,e,b,a);if(!JW.Array.isIdentity(c)){return JW.Array.invert(c)}},detectSortComparing:function(e,d,b,a){var c=JW.Array.getSortingKeysComparing(e,d,b,a);if(!JW.Array.isIdentity(c)){return JW.Array.invert(c)}},performSplice:function(d,b,a,c){var e=JW.Array.detectSplice(d,b,a,c);if(e!==undefined){JW.Array.trySplice(d,e.removeParamsList,e.addParamsList)}},performFilter:function(b,a){var c=JW.Array.detectFilter(b,a);if(c!==undefined){JW.Array.trySplice(b,c,[])}},performReorder:function(e,c,b,d){var a=JW.Array.detectReorder(e,c,b,d);if(a!==undefined){JW.Array.tryReorder(e,a)}},sort:function(d,e,c,a){var b=JW.Array.detectSort(d,e,c,a);if(b!==undefined){JW.Array.tryReorder(d,b)}},sortComparing:function(e,d,c,a){var b=JW.Array.detectSortComparing(e,d,c,a);if(b!==undefined){JW.Array.tryReorder(e,b)}},equal:function(d,a){if(d===a){return true}if(d.length!==a.length){return false}for(var c=0,b=d.length;c<b;++c){if(d[c]!==a[c]){return false}}return true},collapse:function(d,e){var a=[];for(var c=0,b=d.length;c<b;++c){if(!JW.isArray(d[c])){a.push(d[c]);continue}if(!JW.isSet(e)){JW.Array.tryAddAll(a,JW.Array.collapse(d[c]));continue}if(e){JW.Array.tryAddAll(a,JW.Array.collapse(d[c],e-1));continue}a.push(d[c])}return a},indexOf:Array.prototype.indexOf?function(b,a){return b.indexOf(a)}:function(c,b){var a=JW.Array.keyOf(c,b);return(a!==undefined)?a:-1},backEvery:function(c,d,b){for(var a=c.length-1;a>=0;--a){if(d.call(b||c,c[a],a)===false){return false}}return true},cmp:function(c,f,b){var e=Math.min(c.length,f.length);for(var d=0;d<e;++d){var a=JW.cmp(c[d],f[d],b);if(a){return a}}return JW.cmp(c.length,f.length)},shuffle:function(e){var a=new Array(e);for(var d=0;d<e;++d){a[d]=d}for(var d=0;d<e;++d){var b=d+Math.floor(Math.random()*(e-d));var c=a[d];a[d]=a[b];a[b]=c}return a},isIdentity:function(c){for(var b=0,a=c.length;b<a;++b){if(c[b]!==b){return false}}return true},invert:function(d){var b=d.length;var a=new Array(b);for(var c=0;c<b;++c){a[d[c]]=c}return a},merge:function(d){var a=[];for(var c=0,b=d.length;c<b;++c){a.push.apply(a,d[c])}return a},countMerged:function(d){var a=0;for(var c=0,b=d.length;c<b;++c){a+=d[c].length}return a},top:function(a){return JW.Array.getLast(a)},pop:function(a){return a.pop()},binarySearch:function(h,g,f,c){f=f||function(i,j){return(i<j)?-1:(i>j)?1:0};c=c||h;var e=h.length;var a=e>>1;var d=1;while(d<=a){d<<=1}var b=0;while(d){if((b+d<=e)&&(f.call(c,g,h[b+d-1])>=0)){b+=d}d>>=1}return b}});JW.Map=function(b,a){JW.Map._super.call(this,b,a)};JW.extend(JW.Map,JW.AbstractMap,{createEmpty:function(){return new JW.Map()},createEmptyArray:function(){return new JW.Array()},createEmptyMap:function(){return new JW.Map()},createEmptySet:function(){return new JW.Set()}});JW.IndexedCollection.createStaticMethods(JW.Map);JW.apply(JW.Map,{getLength:function(c){var b=0;for(var a in c){++b}return b},isEmpty:function(b){for(var a in b){return false}return true},getFirstKey:function(b){for(var a in b){return a}return undefined},get:function(b,a){return b[a]},getKeys:function(c){var b=[];for(var a in c){b.push(a)}return b},every:function(c,d,b){b=b||c;for(var a in c){if(d.call(b,c[a],a)===false){return false}}return true},filter:function(c,d,b){var a={};JW.Map.every(c,function(f,e){if(d.call(this,f,e)!==false){a[e]=f}},b);return a},$filter:JW.AbstractCollection._createStatic$Map(JW.Map,"filter"),count:function(c,d,b){var a=0;JW.Map.every(c,function(f,e){if(d.call(this,f,e)!==false){++a}},b);return a},map:function(c,d,b){var a={};JW.Map.every(c,function(f,e){a[e]=d.call(this,f,e)},b);return a},$map:JW.AbstractCollection._createStatic$Map(JW.Map,"map"),asMap:function(a){return a},trySet:function(d,b,a){var c=d[a];if(c===b){return}d[a]=b;return new JW.Proxy(c)},setAll:function(b,a){var c=JW.Map.trySetAll(b,a);return(c!==undefined)?c:new JW.AbstractMap.SpliceResult({},{})},trySetAll:function(h,g){var a={};var c={};for(var b in g){var e=g[b];var f=JW.Map.trySet(h,e,b);if(f===undefined){continue}var d=f.value;if(d!==undefined){a[b]=d}c[b]=e}if(!JW.Map.isEmpty(a)||!JW.Map.isEmpty(c)){return new JW.AbstractMap.SpliceResult(a,c)}},setKey:function(c,b,d){var a=JW.Map.trySetKey(c,b,d);return(a!==undefined)?a:c[d]},trySetKey:function(c,b,d){if(b===d){return}var a=c[b];delete c[b];c[d]=a;return a},tryRemove:function(c,a){var b=c[a];if(b!==undefined){delete c[a]}return b},removeAll:function(c,b){var a=JW.Map.tryRemoveAll(c,b);return(a!==undefined)?a:{}},$removeAll:JW.AbstractCollection._createStatic$Map(JW.Map,"removeAll"),tryRemoveAll:function(g,f){var b={};for(var d=0,a=f.length;d<a;++d){var c=f[d];var e=JW.Map.tryRemove(g,c);if(e!==undefined){b[c]=e}}if(!JW.Map.isEmpty(b)){return b}},removeItems:function(d,a){var c=new JW.Set(a);var b=JW.Map.filter(d,function(e){return !c.contains(e)});JW.Map.performSplice(d,b)},clear:function(b){var a=JW.Map.tryClear(b);return(a!==undefined)?a:{}},$clear:JW.AbstractCollection._createStatic$Map(JW.Map,"clear"),tryClear:function(c){if(JW.Map.isEmpty(c)){return}var a=JW.apply({},c);for(var b in a){delete c[b]}return a},splice:function(b,a,c){var d=JW.Map.trySplice(b,a,c);return(d!==undefined)?d:new JW.AbstractMap.SpliceResult({},{})},trySplice:function(c,b,d){b=JW.Array.filter(b,function(f){return !d.hasOwnProperty(f)});var a=JW.Map.tryRemoveAll(c,b);var e=JW.Map.trySetAll(c,d);if(e!==undefined){JW.apply(e.removedItems,a);return e}if(a!==undefined){return new JW.AbstractMap.SpliceResult(a,{})}},reindex:function(b,c){var a=JW.Map.tryReindex(b,c);return(a!==undefined)?a:{}},tryReindex:function(c,f){var e=JW.Map.tryClear(c);
if(e===undefined){return}var a={};for(var b in e){var d=f[b];if((d===undefined)||(d===b)){c[b]=e[b]}else{c[d]=e[b];a[b]=d}}if(!JW.Map.isEmpty(a)){return a}},detectSplice:function(f,a){var c=[];var e={};for(var b in f){if(!a.hasOwnProperty(b)){c.push(b)}}for(var b in a){var d=a[b];if(d!==f[b]){e[b]=d}}if((c.length!==0)||!JW.Map.isEmpty(e)){return new JW.AbstractMap.SpliceParams(c,e)}},detectReindex:function(e,i,b,h){b=b||JW.iid;h=h||e;var g={};for(var f in i){g[b.call(h,i[f])]=f}var c={};for(var a in e){var d=g[b.call(h,e[a])];if(a!==d){c[a]=d}}if(!JW.Map.isEmpty(c)){return c}},performSplice:function(b,a){var c=JW.Map.detectSplice(b,a);if(c!==undefined){JW.Map.trySplice(b,c.removedKeys,c.updatedItems)}},performReindex:function(d,b,a,c){var e=JW.Map.detectReindex(d,b,a,c);if(e!==undefined){JW.Map.tryReindex(d,e)}},equal:function(a,d){if(a===d){return true}var c=JW.Map.getLength(d);for(var b in a){if((--c<0)||(a[b]!==d[b])){return false}}return c===0},single:function(b,c){var a={};a[b]=c;return a},getRemovedKeys:function(a,c){var d=[];for(var b in a){if(!c.hasOwnProperty(b)){d.push(b)}}return d}});JW.Set=function(b,a){JW.Set._super.call(this,b,a)};JW.extend(JW.Set,JW.AbstractSet,{createEmpty:function(){return new JW.Set()},createEmptyArray:function(){return new JW.Array()},createEmptyMap:function(){return new JW.Map()},createEmptySet:function(){return new JW.Set()}});JW.AbstractCollection.createStaticMethods(JW.Set);JW.apply(JW.Set,{getLength:function(c){var b=0;for(var a in c){++b}return b},isEmpty:function(b){for(var a in b){return false}return true},getFirst:function(b){for(var a in b){return b[a]}return undefined},containsItem:function(b,a){return b.hasOwnProperty(a._iid)},contains:function(b,a){return b.hasOwnProperty(a._iid)},every:function(c,d,a){a=a||c;for(var b in c){if(d.call(a,c[b])===false){return false}}return true},filter:function(c,d,b){var a={};JW.Set.every(c,function(e){if(d.call(this,e)!==false){a[e._iid]=e}},b);return a},$filter:JW.AbstractCollection._createStatic$Set(JW.Set,"filter"),count:function(c,d,b){var a=0;JW.Set.every(c,function(e){if(d.call(this,e)!==false){++a}},b);return a},map:function(c,d,b){var a={};JW.Set.every(c,function(e){JW.Set.tryAdd(a,d.call(this,e))},b);return a},$map:JW.AbstractCollection._createStatic$Set(JW.Set,"map"),asSet:function(a){return a},add:function(b,a){return JW.Set.tryAdd(b,a)!==undefined},tryAdd:function(c,a){var b=a._iid;if(c.hasOwnProperty(b)){return}c[b]=a;return true},addAll:function(c,b){var a=JW.Set.tryAddAll(c,b);return(a!==undefined)?a:[]},$addAll:JW.AbstractCollection._createStatic$Array(JW.Set,"addAll"),tryAddAll:function(f,b){var d=[];for(var c=0,a=b.length;c<a;++c){var e=b[c];if(JW.Set.tryAdd(f,e)){d.push(e)}}if(d.length!==0){return d}},remove:function(b,a){return JW.Set.tryRemove(b,a)!==undefined},tryRemove:function(c,a){var b=a._iid;if(!c.hasOwnProperty(b)){return}delete c[b];return true},removeItem:function(b,a){JW.Set.tryRemove(b,a)},removeAll:function(c,b){var a=JW.Set.tryRemoveAll(c,b);return(a!==undefined)?a:[]},$removeAll:JW.AbstractCollection._createStatic$Array(JW.Set,"removeAll"),tryRemoveAll:function(f,c){var b=[];for(var d=0,a=c.length;d<a;++d){var e=c[d];if(JW.Set.tryRemove(f,e)){b.push(e)}}if(b.length!==0){return b}},removeItems:function(b,a){JW.Set.tryRemoveAll(b,a)},clear:function(b){var a=JW.Set.tryClear(b);return(a!==undefined)?a:[]},$clear:JW.AbstractCollection._createStatic$Array(JW.Set,"clear"),tryClear:function(b){var a=JW.Set.toArray(b);if(!a.length){return}JW.Set.tryRemoveAll(b,a);return a},splice:function(c,a,b){var d=JW.Set.trySplice(c,a,b);return(d!==undefined)?d:new JW.AbstractSet.SpliceResult([],[])},trySplice:function(d,a,b){var c=new JW.Set(b);a=JW.Array.filter(a,function(e){return !c.contains(e)});a=JW.Set.tryRemoveAll(d,a);b=JW.Set.tryAddAll(d,b);if((a!==undefined)||(b!==undefined)){return new JW.AbstractSet.SpliceResult(a||[],b||[])}},detectSplice:function(f,e){var a=[];var d=[];var b=JW.Array.index(e,JW.byField("_iid"));for(var c in f){if(!b.hasOwnProperty(c)){a.push(f[c])}}for(var c in b){if(!f.hasOwnProperty(c)){d.push(b[c])}}if((a.length!==0)||(d.length!==0)){return new JW.AbstractSet.SpliceParams(a,d)}},performSplice:function(c,a){var b=JW.Set.detectSplice(c,a);if(b!==undefined){JW.Set.trySplice(c,b.removedItems,b.addedItems)}},equal:function(a,d){if(JW.Set.getLength(a)!==d.length){return false}for(var c=0,b=d.length;c<b;++c){if(!a.hasOwnProperty(d[c]._iid)){return false}}return true},single:function(b){var a={};a[b._iid]=b;return a}});JW.ObservableArray=function(b,a){JW.ObservableArray._super.call(this,b,a);this.length=new JW.Property(this.getLength());this.spliceEvent=new JW.Event();this.replaceEvent=new JW.Event();this.moveEvent=new JW.Event();this.clearEvent=new JW.Event();this.reorderEvent=new JW.Event();this.changeEvent=new JW.Event()};JW.extend(JW.ObservableArray,JW.AbstractArray,{destroy:function(){this.changeEvent.destroy();this.reorderEvent.destroy();this.clearEvent.destroy();this.moveEvent.destroy();this.replaceEvent.destroy();this.spliceEvent.destroy();this.length.destroy();this._super()},trySet:function(b,a){var c=this._super(b,a);if(c===undefined){return}this.replaceEvent.trigger(new JW.ObservableArray.ReplaceEventParams(this,a,c.value,b));this.changeEvent.trigger(new JW.ObservableArray.EventParams(this));return c},tryMove:function(a,c){var b=this._super(a,c);if(b===undefined){return}this.moveEvent.trigger(new JW.ObservableArray.MoveEventParams(this,a,c,b));this.changeEvent.trigger(new JW.ObservableArray.EventParams(this));return b},tryClear:function(){var a=this._super();if(a===undefined){return}this.length.set(0);this.clearEvent.trigger(new JW.ObservableArray.ItemsEventParams(this,a));this.changeEvent.trigger(new JW.ObservableArray.EventParams(this));return a},trySplice:function(c,b){var a=this._super(c,b);if(a===undefined){return}this.length.set(this.getLength());this.spliceEvent.trigger(new JW.ObservableArray.SpliceEventParams(this,a));this.changeEvent.trigger(new JW.ObservableArray.EventParams(this));return a},tryReorder:function(b){var a=this._super(b);if(a===undefined){return}this.reorderEvent.trigger(new JW.ObservableArray.ReorderEventParams(this,b,a));this.changeEvent.trigger(new JW.ObservableArray.EventParams(this));return a},createEmpty:function(){return new JW.ObservableArray()},createEmptyArray:function(){return new JW.ObservableArray()},createEmptyMap:function(){return new JW.ObservableMap()},createEmptySet:function(){return new JW.ObservableSet()},createMapper:function(a){return new JW.ObservableArray.Mapper(this,a)},createFilterer:function(a){return new JW.ObservableArray.Filterer(this,a)},createCounter:function(a){return new JW.ObservableArray.Counter(this,a)},createObserver:function(a){return new JW.ObservableArray.Observer(this,a)},createOrderer:function(a){return new JW.ObservableArray.Orderer(this,a)},createSorterComparing:function(a){return new JW.ObservableArray.SorterComparing(this,a)},createIndexer:function(a){return new JW.ObservableArray.Indexer(this,a)},createLister:function(a){return new JW.ObservableArray.Lister(this,a)},createInserter:function(a){return new JW.ObservableArray.Inserter(this,a)},createMerger:function(a){return new JW.ObservableArray.Merger(this,a)},createMergerBunch:function(a){return new JW.ObservableArray.Merger.Bunch(a,this)},createReverser:function(a){return new JW.ObservableArray.Reverser(this,a)},createSplitter:function(a){return new JW.ObservableArray.Splitter(this,a)}});JW.ObservableArray.EventParams=function(a){JW.ObservableArray.EventParams._super.call(this,a)};JW.extend(JW.ObservableArray.EventParams,JW.EventParams,{});JW.ObservableArray.SpliceEventParams=function(a,b){JW.ObservableArray.SpliceEventParams._super.call(this,a);this.spliceResult=b};JW.extend(JW.ObservableArray.SpliceEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.MoveEventParams=function(a,b,d,c){JW.ObservableArray.MoveEventParams._super.call(this,a);this.fromIndex=b;this.toIndex=d;this.item=c
};JW.extend(JW.ObservableArray.MoveEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.ReplaceEventParams=function(c,a,d,b){JW.ObservableArray.ReplaceEventParams._super.call(this,c);this.index=a;this.oldItem=d;this.newItem=b};JW.extend(JW.ObservableArray.ReplaceEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.ItemsEventParams=function(b,a){JW.ObservableArray.ItemsEventParams._super.call(this,b);this.items=a};JW.extend(JW.ObservableArray.ItemsEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.ReorderEventParams=function(c,b,a){JW.ObservableArray.ReorderEventParams._super.call(this,c,a);this.indexArray=b};JW.extend(JW.ObservableArray.ReorderEventParams,JW.ObservableArray.ItemsEventParams,{});JW.ObservableArray.Counter=function(b,a){JW.ObservableArray.Counter._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableArray.Counter,JW.AbstractArray.Counter,{_onSplice:function(b){var c=b.spliceResult;var a=this.target.get();JW.Array.every(c.removedItemsList,function(d){a-=JW.Array.count(d.items,this.filterItem,this.scope)},this);JW.Array.every(c.addedItemsList,function(d){a+=JW.Array.count(d.items,this.filterItem,this.scope)},this);this.target.set(a)},_onReplace:function(c){var a=this.filterItem.call(this.scope,c.oldItem)!==false;var b=this.filterItem.call(this.scope,c.newItem)!==false;if(a&&!b){this.target.set(this.target.get()-1)}else{if(!a&&b){this.target.set(this.target.get()+1)}}},_onClear:function(a){this.target.set(0)}});JW.ObservableArray.Filterer=function(b,a){JW.ObservableArray.Filterer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.moveEvent.bind(this._onMove,this));this.own(b.clearEvent.bind(this._onClear,this));this.own(b.reorderEvent.bind(this._onReorder,this))};JW.extend(JW.ObservableArray.Filterer,JW.AbstractArray.Filterer,{_onSplice:function(a){var b=a.spliceResult;this._splice(b.removedItemsList,b.addedItemsList)},_onReplace:function(d){var b=this._filtered[d.index]!==0;var c=this.filterItem.call(this.scope,d.newItem)!==false;if(!b&&!c){return}var a=this._countFiltered(0,d.index);this._filtered[d.index]=c?1:0;if(!c){this.target.tryRemove(a)}else{if(!b){this.target.tryAdd(d.newItem,a)}else{this.target.trySet(d.newItem,a)}}},_onMove:function(c){if(this._filtered[c.fromIndex]!==0){var a,b;if(c.fromIndex<c.toIndex){a=this._countFiltered(0,c.fromIndex);b=a+this._countFiltered(c.fromIndex+1,c.toIndex-c.fromIndex)}else{b=this._countFiltered(0,c.toIndex);a=b+this._countFiltered(c.toIndex,c.fromIndex-c.toIndex)}this.target.tryMove(a,b)}JW.Array.tryMove(this._filtered,c.fromIndex,c.toIndex)},_onClear:function(a){this.target.tryClear()},_onReorder:function(f){var c=0;var e={};for(var a=0,b=this._filtered.length;a<b;++a){if(this._filtered[a]!==0){e[f.indexArray[a]]=c++}}JW.Array.tryReorder(this._filtered,f.indexArray);var c=0;var d=new Array(this.target.getLength());for(var a=0,b=this._filtered.length;a<b;++a){if(this._filtered[a]!==0){d[e[a]]=c++}}this.target.tryReorder(d)}});JW.ObservableArray.Indexer=function(b,a){JW.ObservableArray.Indexer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableArray.Indexer,JW.AbstractArray.Indexer,{_onSplice:function(a){var b=a.spliceResult;this.target.trySplice(this._keys(b.getRemovedItems()),this._index(b.getAddedItems()))},_onReplace:function(a){this.target.trySplice(this._keys([a.oldItem]),this._index([a.newItem]))},_onClear:function(a){this.target.tryRemoveAll(this._keys(a.items))}});JW.ObservableArray.Inserter=function(b,a){JW.ObservableArray.Inserter._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.moveEvent.bind(this._onMove,this));this.own(b.clearEvent.bind(this._onClear,this));this.own(b.reorderEvent.bind(this._onReorder,this))};JW.extend(JW.ObservableArray.Inserter,JW.AbstractArray.Inserter,{_onSplice:function(c){var e=c.spliceResult;var h=e.oldItems;var j=e.getRemovedItems();if(this.clearItems&&(3*j.length>2*h.length)){this.clearItems.call(this.scope,h);this._addItems(this.source.getItems(),0);return}var g=e.removedItemsList;var a=e.addedItemsList;for(var d=g.length-1;d>=0;--d){var k=g[d];this._removeItems(k.items,k.index)}for(var d=0,b=a.length;d<b;++d){var f=a[d];this._addItems(f.items,f.index)}},_onReplace:function(a){if(this.removeItem){this.removeItem.call(this.scope,a.oldItem,a.index)}if(this.addItem){this.addItem.call(this.scope,a.newItem,a.index)}},_onMove:function(a){if(this.removeItem){this.removeItem.call(this.scope,a.item,a.fromIndex)}if(this.addItem){this.addItem.call(this.scope,a.item,a.toIndex)}},_onClear:function(a){this._clearItems(a.items)},_onReorder:function(a){this._clearItems(a.items);this._addItems(this.source.getItems(),0)}});JW.ObservableArray.Lister=function(b,a){JW.ObservableArray.Lister._super.call(this,b,a);this.own(this.source.spliceEvent.bind(this._onSplice,this));this.own(this.source.replaceEvent.bind(this._onReplace,this));this.own(this.source.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableArray.Lister,JW.AbstractArray.Lister,{_onSplice:function(a){var b=a.spliceResult;this.target.trySplice(b.getRemovedItems(),b.getAddedItems())},_onReplace:function(a){this.target.trySplice([a.oldItem],[a.newItem])},_onClear:function(a){this.target.tryRemoveAll(a.items)}});JW.ObservableArray.Mapper=function(b,a){JW.ObservableArray.Mapper._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.moveEvent.bind(this._onMove,this));this.own(b.clearEvent.bind(this._onClear,this));this.own(b.reorderEvent.bind(this._onReorder,this))};JW.extend(JW.ObservableArray.Mapper,JW.AbstractArray.Mapper,{_onSplice:function(e){var c=e.spliceResult;var b=c.addedItemsList;var k=[];for(var f=0,d=b.length;f<d;++f){var j=b[f];k.push(new JW.AbstractArray.IndexItems(j.index,this._createItems(j.items)))}var h=this.target.trySplice(c.getRemoveParamsList(),k);var g=c.removedItemsList;var a=h.removedItemsList;for(var f=a.length-1;f>=0;--f){this._destroyItems(a[f].items,g[f].items)}},_onReplace:function(c){var a=this.createItem.call(this.scope,c.newItem);var b=this.target.trySet(a,c.index).value;this.destroyItem.call(this.scope,b,c.oldItem)},_onMove:function(a){this.target.tryMove(a.fromIndex,a.toIndex)},_onClear:function(a){this._destroyItems(this.target.tryClear(),a.items)},_onReorder:function(a){this.target.tryReorder(a.indexArray)}});JW.ObservableArray.Merger=function(b,a){JW.ObservableArray.Merger._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.moveEvent.bind(this._onMove,this));this.own(b.clearEvent.bind(this._onClear,this));this.own(b.reorderEvent.bind(this._onReorder,this))};JW.extend(JW.ObservableArray.Merger,JW.AbstractArray.Merger,{_createTarget:function(){return new JW.ObservableArray()},_getIndexes:function(c){var a=0;var b=JW.Array.map(c,function(d){var e=a;a+=d.getLength();return e},this);b.push(a);return b},_onSplice:function(c){var e=c.spliceResult;var a=this._getIndexes(e.oldItems);var d=JW.Array.map(e.removedItemsList,function(f){return new JW.AbstractArray.IndexCount(a[f.index],this._count(f.items))},this);JW.Array.backEvery(e.removedItemsList,function(h){a.splice(h.index,h.items.length);var g=this._count(h.items);for(var f=h.index;f<a.length;++f){a[f]-=g}},this);var b=JW.Array.map(e.addedItemsList,function(f){return new JW.AbstractArray.IndexItems(a[f.index],this._merge(f.items))},this);this.target.trySplice(d,b)},_onReplace:function(b){var a=this._count(this.source.getItems(),0,b.index);this.target.trySplice([new JW.AbstractArray.IndexCount(a,b.oldItem.getLength())],[new JW.AbstractArray.IndexItems(a,b.newItem.getItems())])
},_onMove:function(g){var e=g.item.getLength();var c=new Array(this.target.getLength());var b=0;function f(k,h){for(var i=0;i<k;++i){c[b]=b+h;++b}}for(var d=0,a=Math.min(g.fromIndex,g.toIndex);d<a;++d){f(this.source.get(d).getLength(),0)}if(g.fromIndex<=g.toIndex){f(e,this._count(this.source.getItems(),g.fromIndex,g.toIndex-g.fromIndex));for(var d=g.fromIndex;d<g.toIndex;++d){f(this.source.get(d).getLength(),-e)}}else{for(var d=g.toIndex+1;d<=g.fromIndex;++d){f(this.source.get(d).getLength(),e)}f(e,-this._count(this.source.getItems(),g.toIndex+1,g.fromIndex-g.toIndex))}for(var d=Math.max(g.fromIndex,g.toIndex)+1,a=this.source.getLength();d<a;++d){f(this.source.get(d).getLength(),0)}this.target.tryReorder(c)},_onClear:function(a){this.target.tryClear()},_onReorder:function(c){var g=this._getIndexes(c.items);var n=this._getIndexes(this.source.getItems());var f=new Array(this.target.getLength());for(var e=0,b=c.items.length;e<b;++e){var o=c.items[e];var h=g[e];var k=n[c.indexArray[e]];for(var d=0,a=o.getLength();d<a;++d){f[h+d]=k+d}}this.target.tryReorder(f)}});JW.ObservableArray.Merger.Bunch=function(b,a){JW.ObservableArray.Merger.Bunch._super.call(this);this.source=b.source;this.target=b.target;this.bunch=a;this.own(a.spliceEvent.bind(this._onSplice,this));this.own(a.replaceEvent.bind(this._onReplace,this));this.own(a.moveEvent.bind(this._onMove,this));this.own(a.clearEvent.bind(this._onClear,this));this.own(a.reorderEvent.bind(this._onReorder,this))};JW.extend(JW.ObservableArray.Merger.Bunch,JW.AbstractArray.Merger.Bunch,{_getIndex:function(){var e=this.source.getItems();var c=0;for(var d=0,b=e.length;d<b;++d){var a=e[d];if(a===this.bunch){return c}c+=a.getLength()}console.warn("JW.ObservableArray.Merger object is corrupted");return 0},_onSplice:function(c){var e=c.spliceResult;var a=this._getIndex();var d=JW.Array.map(e.removedItemsList,function(f){return new JW.AbstractArray.IndexCount(f.index+a,f.items.length)},this);var b=JW.Array.map(e.addedItemsList,function(f){return new JW.AbstractArray.IndexItems(f.index+a,f.items.concat())},this);this.target.trySplice(d,b)},_onReplace:function(a){this.target.trySet(a.newItem,this._getIndex()+a.index)},_onMove:function(b){var a=this._getIndex();this.target.tryMove(a+b.fromIndex,a+b.toIndex)},_onClear:function(a){this.target.tryRemoveAll(this._getIndex(),a.items.length)},_onReorder:function(g){var b=this._getIndex();var f=g.indexArray;var a=f.length;var e=this.target.getLength();var d=new Array(e);for(var c=0;c<b;++c){d[c]=c}for(var c=0;c<a;++c){d[b+c]=b+f[c]}for(var c=b+a;c<e;++c){d[c]=c}this.target.tryReorder(d)}});JW.ObservableArray.Observer=function(b,a){JW.ObservableArray.Observer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.clearEvent.bind(this._onClear,this));if(this.change){this.own(b.changeEvent.bind(this._onChange,this))}};JW.extend(JW.ObservableArray.Observer,JW.AbstractArray.Observer,{_onSplice:function(c){var d=c.spliceResult;var b=d.oldItems;var a=d.getRemovedItems();if(this.clearItems&&(3*a.length>2*b.length)){this.clearItems.call(this.scope,b);this._addItems(this.source.getItems())}else{this._removeItems(a);this._addItems(d.getAddedItems())}},_onReplace:function(a){if(this.removeItem){this.removeItem.call(this.scope,a.oldItem)}if(this.addItem){this.addItem.call(this.scope,a.newItem)}},_onClear:function(a){this._clearItems(a.items)}});JW.ObservableArray.Orderer=function(b,a){JW.ObservableArray.Orderer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableArray.Orderer,JW.AbstractArray.Orderer,{_onSplice:function(a){var b=a.spliceResult;this._splice(JW.Array.toSet(b.getRemovedItems()),JW.Array.toSet(b.getAddedItems()))},_onReplace:function(b){var a=this.target.keyOf(b.oldItem);this.target.trySplice([new JW.AbstractArray.IndexCount(a,1)],[new JW.AbstractArray.IndexItems(this.target.getLength()-1,[b.newItem])])},_onClear:function(a){this.target.removeItems(a.items)}});JW.ObservableArray.Reverser=function(b,a){JW.ObservableArray.Reverser._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.moveEvent.bind(this._onMove,this));this.own(b.clearEvent.bind(this._onClear,this));this.own(b.reorderEvent.bind(this._onReorder,this))};JW.extend(JW.ObservableArray.Reverser,JW.AbstractArray.Reverser,{_onSplice:function(e){var g=e.spliceResult;var c=this.target.getLength();var d=c;var f=JW.Array.map(g.removedItemsList,function(j){var i=j.items.length;var h=c-j.index-i;d-=i;return new JW.AbstractArray.IndexCount(h,i)},this);f.reverse();var a=g.addedItemsList.concat();a.reverse();JW.Array.each(a,function(h){d+=h.items.length},this);var b=JW.Array.map(a,function(k){var h=k.items;var j=h.length;var i=d-k.index-j;return new JW.AbstractArray.IndexItems(i,this._reverse(h))},this);this.target.trySplice(f,b)},_onReplace:function(a){this.target.trySet(a.newItem,this.target.getLength()-a.index-1)},_onMove:function(a){this.target.tryMove(this.target.getLength()-a.fromIndex-1,this.target.getLength()-a.toIndex-1)},_onClear:function(a){this.target.tryClear()},_onReorder:function(e){var b=e.indexArray;var d=b.length;var a=new Array(b.length);for(var c=0;c<d;++c){a[d-c-1]=d-b[c]-1}this.target.tryReorder(a)}});JW.ObservableArray.SorterComparing=function(b,a){JW.ObservableArray.SorterComparing._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.replaceEvent.bind(this._onReplace,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableArray.SorterComparing,JW.AbstractArray.SorterComparing,{_onSplice:function(a){var b=a.spliceResult;this._splice(b.getRemovedItems(),b.getAddedItems())},_onReplace:function(a){this._splice([a.oldItem],[a.newItem])},_onClear:function(a){this._splice(a.items,[])}});JW.ObservableArray.Splitter=JW.AbstractArray.Splitter.extend();JW.ObservableMap=function(b,a){JW.ObservableMap._super.call(this,b,a);this.length=new JW.Property(this.getLength());this.spliceEvent=new JW.Event();this.reindexEvent=new JW.Event();this.clearEvent=new JW.Event();this.changeEvent=new JW.Event()};JW.extend(JW.ObservableMap,JW.AbstractMap,{destroy:function(){this.changeEvent.destroy();this.clearEvent.destroy();this.reindexEvent.destroy();this.spliceEvent.destroy();this.length.destroy();this._super()},trySplice:function(a,b){var c=this._super(a,b);if(c===undefined){return}this.length.set(this.getLength());this.spliceEvent.trigger(new JW.ObservableMap.SpliceEventParams(this,c));this.changeEvent.trigger(new JW.ObservableMap.EventParams(this));return c},tryClear:function(){var a=this._super();if(a===undefined){return}this.length.set(0);this.clearEvent.trigger(new JW.ObservableMap.ItemsEventParams(this,a));this.changeEvent.trigger(new JW.ObservableMap.EventParams(this));return a},tryReindex:function(b){var a=this._super(b);if(a===undefined){return}this.reindexEvent.trigger(new JW.ObservableMap.ReindexEventParams(this,a));this.changeEvent.trigger(new JW.ObservableMap.EventParams(this));return a},createEmpty:function(){return new JW.ObservableMap()},createEmptyArray:function(){return new JW.ObservableArray()},createEmptyMap:function(){return new JW.ObservableMap()},createEmptySet:function(){return new JW.ObservableSet()},createMapper:function(a){return new JW.ObservableMap.Mapper(this,a)},createFilterer:function(a){return new JW.ObservableMap.Filterer(this,a)},createCounter:function(a){return new JW.ObservableMap.Counter(this,a)},createObserver:function(a){return new JW.ObservableMap.Observer(this,a)},createOrderer:function(a){return new JW.ObservableMap.Orderer(this,a)},createSorterComparing:function(a){return new JW.ObservableMap.SorterComparing(this,a)},createIndexer:function(a){return new JW.ObservableMap.Indexer(this,a)},createLister:function(a){return new JW.ObservableMap.Lister(this,a)
},createInserter:function(a){return new JW.ObservableMap.Inserter(this,a)}});JW.ObservableMap.EventParams=function(a){JW.ObservableMap.EventParams._super.call(this,a)};JW.extend(JW.ObservableMap.EventParams,JW.EventParams,{});JW.ObservableMap.SpliceEventParams=function(a,b){JW.ObservableMap.SpliceEventParams._super.call(this,a);this.spliceResult=b};JW.extend(JW.ObservableMap.SpliceEventParams,JW.ObservableMap.EventParams,{});JW.ObservableMap.ReindexEventParams=function(a,b){JW.ObservableMap.ReindexEventParams._super.call(this,a);this.keyMap=b};JW.extend(JW.ObservableMap.ReindexEventParams,JW.ObservableMap.EventParams,{});JW.ObservableMap.ItemsEventParams=function(b,a){JW.ObservableMap.ItemsEventParams._super.call(this,b);this.items=a};JW.extend(JW.ObservableMap.ItemsEventParams,JW.ObservableMap.EventParams,{});JW.ObservableMap.Counter=function(b,a){JW.ObservableMap.Counter._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableMap.Counter,JW.AbstractMap.Counter,{_onSplice:function(a){var b=a.spliceResult;this.target.set(this.target.get()-JW.Map.count(b.removedItems,this.filterItem,this.scope)+JW.Map.count(b.addedItems,this.filterItem,this.scope))},_onClear:function(a){this.target.set(0)}});JW.ObservableMap.Filterer=function(b,a){JW.ObservableMap.Filterer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.reindexEvent.bind(this._onReindex,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableMap.Filterer,JW.AbstractMap.Filterer,{_onSplice:function(a){var b=a.spliceResult;this.target.trySplice(JW.Map.getKeys(b.removedItems),JW.Map.filter(b.addedItems,this.filterItem,this.scope))},_onReindex:function(a){this.target.tryReindex(a.keyMap)},_onClear:function(a){this.target.tryRemoveAll(JW.Map.getKeys(a.items))}});JW.ObservableMap.Indexer=function(b,a){JW.ObservableMap.Indexer._super.call(this,b,a);this.own(this.source.spliceEvent.bind(this._onSplice,this));this.own(this.source.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableMap.Indexer,JW.AbstractMap.Indexer,{_onSplice:function(a){var b=a.spliceResult;this.target.trySplice(this._keys(JW.Map.toArray(b.removedItems)),this._index(JW.Map.toArray(b.addedItems)))},_onClear:function(a){this.target.tryRemoveAll(this._keys(JW.Map.toArray(a.items)))}});JW.ObservableMap.Inserter=function(b,a){JW.ObservableMap.Inserter._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.reindexEvent.bind(this._onReindex,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableMap.Inserter,JW.AbstractMap.Inserter,{_onSplice:function(a){var b=a.spliceResult;this._removeItems(b.removedItems);this._addItems(b.addedItems)},_onReindex:function(d){var e=d.keyMap;for(var b in e){var c=e[b];var a=this.source.get(c);if(this.removeItem){this.removeItem.call(this.scope,b,a)}if(this.addItem){this.addItem.call(this.scope,a,c)}}},_onClear:function(a){this._clearItems(a.items)}});JW.ObservableMap.Lister=function(b,a){JW.ObservableMap.Lister._super.call(this,b,a);this.own(this.source.spliceEvent.bind(this._onSplice,this));this.own(this.source.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableMap.Lister,JW.AbstractMap.Lister,{_onSplice:function(a){var b=a.spliceResult;this.target.trySplice(JW.Map.toArray(b.removedItems),JW.Map.toArray(b.addedItems))},_onClear:function(a){this.target.tryRemoveAll(JW.Map.toArray(a.items))}});JW.ObservableMap.Mapper=function(b,a){JW.ObservableMap.Mapper._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.reindexEvent.bind(this._onReindex,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableMap.Mapper,JW.AbstractMap.Mapper,{_onSplice:function(d){var c=d.spliceResult;var e=c.removedItems;var b=c.addedItems;var a=this.target.trySplice(JW.Map.getRemovedKeys(e,b),this._createItems(b));if(a!==undefined){this._destroyItems(a.removedItems,e)}},_onReindex:function(a){this.target.tryReindex(a.keyMap)},_onClear:function(b){var a=b.items;this._destroyItems(this.target.tryRemoveAll(JW.Map.getKeys(a)),a)}});JW.ObservableMap.Observer=function(b,a){JW.ObservableMap.Observer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this));if(this.change){this.own(b.changeEvent.bind(this._onChange,this))}};JW.extend(JW.ObservableMap.Observer,JW.AbstractMap.Observer,{_onSplice:function(a){var b=a.spliceResult;this._removeItems(JW.Map.toArray(b.removedItems));this._addItems(JW.Map.toArray(b.addedItems))},_onClear:function(a){this._clearItems(JW.Map.toArray(a.items))}});JW.ObservableMap.Orderer=function(b,a){JW.ObservableMap.Orderer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableMap.Orderer,JW.AbstractMap.Orderer,{_onSplice:function(a){var b=a.spliceResult;this._splice(JW.Map.toSet(b.removedItems),JW.Map.toSet(b.addedItems))},_onClear:function(a){this.target.removeItems(JW.Map.toArray(a.items))}});JW.ObservableMap.SorterComparing=function(b,a){JW.ObservableMap.SorterComparing._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableMap.SorterComparing,JW.AbstractMap.SorterComparing,{_onSplice:function(a){var b=a.spliceResult;this._splice(JW.Map.toArray(b.removedItems),JW.Map.toArray(b.addedItems))},_onClear:function(a){this._splice(JW.Map.toArray(a.items),[])}});JW.ObservableSet=function(b,a){JW.ObservableSet._super.call(this,b,a);this.length=new JW.Property(this.getLength());this.spliceEvent=new JW.Event();this.clearEvent=new JW.Event();this.changeEvent=new JW.Event()};JW.extend(JW.ObservableSet,JW.AbstractSet,{destroy:function(){this.changeEvent.destroy();this.clearEvent.destroy();this.spliceEvent.destroy();this.length.destroy();this._super()},tryClear:function(){var a=this._super();if(a===undefined){return}this.length.set(0);this.clearEvent.trigger(new JW.ObservableSet.ItemsEventParams(this,a));this.changeEvent.trigger(new JW.ObservableSet.EventParams(this));return a},trySplice:function(a,b){var c=this._super(a,b);if(c===undefined){return}this.length.set(this.getLength());this.spliceEvent.trigger(new JW.ObservableSet.SpliceEventParams(this,c));this.changeEvent.trigger(new JW.ObservableSet.EventParams(this));return c},createEmpty:function(){return new JW.ObservableSet()},createEmptyArray:function(){return new JW.ObservableArray()},createEmptyMap:function(){return new JW.ObservableMap()},createEmptySet:function(){return new JW.ObservableSet()},createMapper:function(a){return new JW.ObservableSet.Mapper(this,a)},createFilterer:function(a){return new JW.ObservableSet.Filterer(this,a)},createCounter:function(a){return new JW.ObservableSet.Counter(this,a)},createObserver:function(a){return new JW.ObservableSet.Observer(this,a)},createOrderer:function(a){return new JW.ObservableSet.Orderer(this,a)},createSorterComparing:function(a){return new JW.ObservableSet.SorterComparing(this,a)},createIndexer:function(a){return new JW.ObservableSet.Indexer(this,a)},createLister:function(a){return new JW.ObservableSet.Lister(this,a)}});JW.ObservableSet.EventParams=function(a){JW.ObservableSet.EventParams._super.call(this,a)};JW.extend(JW.ObservableSet.EventParams,JW.EventParams,{});JW.ObservableSet.SpliceEventParams=function(a,b){JW.ObservableSet.SpliceEventParams._super.call(this,a);this.spliceResult=b};JW.extend(JW.ObservableSet.SpliceEventParams,JW.ObservableSet.EventParams,{});JW.ObservableSet.ItemsEventParams=function(b,a){JW.ObservableSet.ItemsEventParams._super.call(this,b);this.items=a};JW.extend(JW.ObservableSet.ItemsEventParams,JW.ObservableSet.EventParams,{});JW.ObservableSet.Counter=function(b,a){JW.ObservableSet.Counter._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this))
};JW.extend(JW.ObservableSet.Counter,JW.AbstractSet.Counter,{_onSplice:function(a){var b=a.spliceResult;this.target.set(this.target.get()-JW.Array.count(b.removedItems,this.filterItem,this.scope)+JW.Array.count(b.addedItems,this.filterItem,this.scope))},_onClear:function(a){this.target.set(0)}});JW.ObservableSet.Filterer=function(b,a){JW.ObservableSet.Filterer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableSet.Filterer,JW.AbstractSet.Filterer,{_onSplice:function(a){var b=a.spliceResult;this.target.trySplice(b.removedItems,JW.Array.filter(b.addedItems,this.filterItem,this.scope))},_onClear:function(a){this.target.tryRemoveAll(a.items)}});JW.ObservableSet.Indexer=function(b,a){JW.ObservableSet.Indexer._super.call(this,b,a);this.own(this.source.spliceEvent.bind(this._onSplice,this));this.own(this.source.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableSet.Indexer,JW.AbstractSet.Indexer,{_onSplice:function(a){var b=a.spliceResult;this.target.trySplice(this._keys(b.removedItems),this._index(b.addedItems))},_onClear:function(a){this.target.tryRemoveAll(this._keys(a.items))}});JW.ObservableSet.Lister=function(b,a){JW.ObservableSet.Lister._super.call(this,b,a);this.own(this.source.spliceEvent.bind(this._onSplice,this));this.own(this.source.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableSet.Lister,JW.AbstractSet.Lister,{_onSplice:function(a){var b=a.spliceResult;this.target.trySplice(b.removedItems,b.addedItems)},_onClear:function(a){this.target.tryRemoveAll(a.items)}});JW.ObservableSet.Mapper=function(b,a){JW.ObservableSet.Mapper._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableSet.Mapper,JW.AbstractSet.Mapper,{_onSplice:function(b){var d=b.spliceResult;var c=d.removedItems;var a=d.addedItems;this.target.trySplice(this._getItems(c),this._createItems(a));this._destroyItems(c)},_onClear:function(b){var a=b.items;this.target.tryRemoveAll(this._getItems(a));this._destroyItems(a)}});JW.ObservableSet.Observer=function(b,a){JW.ObservableSet.Observer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this));if(this.change){this.own(b.changeEvent.bind(this._onChange,this))}};JW.extend(JW.ObservableSet.Observer,JW.AbstractSet.Observer,{_onSplice:function(a){var b=a.spliceResult;this._removeItems(b.removedItems);this._addItems(b.addedItems)},_onClear:function(a){this._clearItems(a.items)}});JW.ObservableSet.Orderer=function(b,a){JW.ObservableSet.Orderer._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableSet.Orderer,JW.AbstractSet.Orderer,{_onSplice:function(a){var b=a.spliceResult;this._splice(JW.Array.toSet(b.removedItems),JW.Array.toSet(b.addedItems))},_onClear:function(a){this.target.removeItems(a.items)}});JW.ObservableSet.SorterComparing=function(b,a){JW.ObservableSet.SorterComparing._super.call(this,b,a);this.own(b.spliceEvent.bind(this._onSplice,this));this.own(b.clearEvent.bind(this._onClear,this))};JW.extend(JW.ObservableSet.SorterComparing,JW.AbstractSet.SorterComparing,{_onSplice:function(a){var b=a.spliceResult;this._splice(b.removedItems,b.addedItems)},_onClear:function(a){this._splice(a.items,[])}});JW.Copier=function(b,a){JW.Copier._super.call(this);a=a||{};this.source=b;this.target=a.target||this.own(new JW.Property());this._update();this.own(b.changeEvent.bind(this._update,this))};JW.extend(JW.Copier,JW.Class,{_update:function(){this.target.set(this.source.get())}});JW.Functor=function(b,d,c,a){JW.Functor._super.call(this);a=a||{};this.sources=b;this.func=d;this.scope=c||this;this.target=a.target||this.own(new JW.Property());this.update();JW.Array.every(b,this.watch,this)};JW.extend(JW.Functor,JW.Class,{bind:function(a){this.own(a.bind(this.update,this));return this},watch:function(a){this.bind(a.changeEvent);return this},update:function(){var a=JW.Array.map(this.sources,JW.byMethod("get"));this.target.set(this.func.apply(this.scope,a))}});JW.Mapper=function(b,a){JW.Mapper._super.call(this);this.sources=b;this.createValue=a.createValue;this.destroyValue=a.destroyValue;this.scope=a.scope||this;this.target=a.target||this.own(new JW.Property());this.acceptNull=a.acceptNull||false;this._sourceValues=null;this._targetValue=null;this.update();JW.Array.every(b,this.watch,this)};JW.extend(JW.Mapper,JW.Class,{destroy:function(){var a=this.target.get();if(a===this._targetValue){this.target.set(null)}this._done();this._sourceValues=null;this._super()},bind:function(a){this.own(a.bind(this.update,this));return this},watch:function(a){this.bind(a.changeEvent);return this},update:function(){var a=JW.Array.map(this.sources,JW.byMethod("get"));var b;if(this.acceptNull||JW.Array.every(a,JW.isSet)){b=this.createValue.apply(this.scope,a)}else{b=null;a=null}this.target.set(b);this._done();this._targetValue=b;this._sourceValues=a},_done:function(){if(this.destroyValue&&this._sourceValues){this.destroyValue.apply(this.scope,[this._targetValue].concat(this._sourceValues))}}});JW.Property=function(a){JW.Property._super.call(this);this._value=JW.defn(a,null);this._ownsValue=false;this._copier=null;this.changeEvent=this.own(new JW.Event())};JW.extend(JW.Property,JW.Class,{destroy:function(){this.bindTo();if(this._ownsValue&&JW.isSet(this._value)){this._value.destroy()}this._super()},get:function(){return this._value},set:function(b){if(b===undefined){b=null}var a=this._value;if(a===b){return}this._value=b;this.changeEvent.trigger(new JW.ValueChangeEventParams(this,b,a));if(this._ownsValue&&JW.isSet(a)){a.destroy()}},ownValue:function(){this._ownsValue=true;return this},bindTo:function(a){if(this._copier){this._copier.destroy();this._copier=null}if(a){this._copier=new JW.Copier(a,{target:this})}}});JW.Switcher=function(b,a){JW.Switcher._super.call(this);a=a||{};this.sources=b;this.init=a.init;this.done=a.done;this.scope=a.scope||this;this.acceptNull=a.acceptNull||false;this._values=null;this._init();JW.Array.every(b,this.watch,this)};JW.extend(JW.Switcher,JW.Class,{destroy:function(){this._done();this._super()},bind:function(a){this.own(a.bind(this.update,this));return this},watch:function(a){this.bind(a.changeEvent);return this},update:function(){this._done();this._init()},_init:function(){var a=JW.Array.map(this.sources,JW.byMethod("get"));this._values=(this.acceptNull||JW.Array.every(a,JW.isSet))?a:null;if(this._values&&this.init){this.init.apply(this.scope,this._values)}},_done:function(){if(this._values&&this.done){this.done.apply(this.scope,this._values)}this._values=null}});JW.Updater=function(a,c,b){JW.Updater._super.call(this);this.sources=a;this.func=c;this.scope=b||this;this.update();JW.Array.every(a,this.watch,this)};JW.extend(JW.Updater,JW.Class,{bind:function(a){this.own(a.bind(this.update,this));return this},watch:function(a){this.bind(a.changeEvent);return this},update:function(){var a=JW.Array.map(this.sources,JW.byMethod("get"));this.func.apply(this.scope,a)}});JW.makeRegistry=function(a,b){b=b||"id";JW.apply(a,{items:{},itemArray:[],registerItem:function(c){a.items[c[b]]=c;a.itemArray.push(c)},getItem:function(c){return(c instanceof a)?c:a.items[c]},getId:function(c){return(c instanceof a)?c[b]:c}});return a};JW.makeFactory=JW.makeRegistry;JW.Interval=function(c,b,a){JW.Interval._super.call(this);if(JW.isSet(b)&&(typeof b==="object")){c=JW.inScope(c,b)}else{if(typeof b==="number"){a=b}}this.interval=setInterval(c,a)};JW.extend(JW.Interval,JW.Class,{destroy:function(){clearInterval(this.interval);this._super()}});JW.Proxy=function(a){JW.Proxy._super.call(this);this.value=a;this._ownsValue=false};JW.extend(JW.Proxy,JW.Class,{destroy:function(){if(this._ownsValue&&JW.isSet(this.value)){this.value.destroy()}this._super()},get:function(){return this.value},set:function(b){var a=this.value;if(a===b){return
}this.value=b;if(this._ownsValue&&JW.isSet(a)){a.destroy()}},ownValue:function(){this._ownsValue=true;return this}});JW.setInterval=function(callback,ms){if(!ms){return setInterval(callback,ms)}if(typeof callback=="string"){callback=function(){eval(callback)}}var lastTime=Date.getTime();function onInterval(){var curTime=Date.getTime();if(curTime-lastTime>10*ms){lastTime=curTime-ms}var b=true;while(b||(lastTime<curTime)){b=false;lastTime+=ms;callback()}}return setInterval(onInterval,ms)};JW.String={htmlEncode:function(a){return String(a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(a){return String(a).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},removeScripts:function(c){c=String(c);var a=[];var b=0;while(true){var d=c.indexOf("<script",b);if(d===-1){break}a.push(c.substr(b,d-b));b=c.indexOf("<\/script>",d)+9;if(b===-1){return a.join("")}}a.push(c.substr(b));return a.join("")},ellipsis:function(c,b,a){c=String(c);if(c.length<=b){return c}a=a||"...";return c.substr(0,b-a.length)+a},prepend:function(e,d,c){e=String(e);var a=[];d-=e.length;for(var b=0;b<d;++b){a.push(c)}a.push(e);return a.join("")},capitalize:function(a){a=String(a);return a.charAt(0).toUpperCase()+a.substr(1)},camel:function(a){return String(a).replace(/-([a-z])/ig,JW.String._fcamel)},hyphen:function(a){return String(a).replace(/([A-Z])/g,JW.String._fhyphen)},trim:function(a){return String(a).replace(/^\s*/,"").replace(/\s*$/,"")},parseClass:function(c){if(JW.isArray(c)){var a=[];for(var b=0;b<c.length;++b){a.push.apply(a,JW.String.parseClass(c[b]))}return a}if(typeof c==="string"){c=JW.String.trim(c);if(c===""){return[]}return c.split(/\s+/)}return[]},_fcamel:function(d,c){return c.toUpperCase()},_fhyphen:function(d,c){return"-"+c.toLowerCase()}};JW.Timeout=function(c,b,a){JW.Timeout._super.call(this);if(JW.isSet(b)&&(typeof b==="object")){c=JW.inScope(c,b)}else{if(typeof b==="number"){a=b}}this.timeout=setTimeout(c,a)};JW.extend(JW.Timeout,JW.Class,{destroy:function(){clearTimeout(this.timeout);this._super()}});JW.Timer=function(b,c,a){JW.Timer._super.call(this);this.tickEvent=this.own(new JW.Event());this.delay=b||0;this.repeat=c||false;this.sensitive=a||false;this._handle=0;this._onTimeout=JW.inScope(this._onTimeout,this)};JW.extend(JW.Timer,JW.Class,{destroy:function(){this.stop();this._super()},start:function(){if(this.isStarted()){return}var a=this._getRunner();this._handle=a(this._onTimeout,this.delay)},stop:function(){if(!this.isStarted()){return}var a=this._getStopper();a(this._handle);this._handle=0},restart:function(){this.stop();this.start()},isStarted:function(){return this._handle!==0},_getRunner:function(){return !this.repeat?setTimeout:this.sensitive?JW.setInterval:setInterval},_getStopper:function(){return this.repeat?clearInterval:clearTimeout},_onTimeout:function(){if(!this.repeat){this._handle=0}this.tickEvent.trigger(new JW.Timer.EventParams(this))}});JW.Timer.EventParams=JW.EventParams.extend();